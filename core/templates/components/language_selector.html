{% load i18n %}
{% get_current_language as CURRENT_LANG %}

<div id="languageSelectorOverlay" class="cookie-consent-overlay" style="display: none;">
  <div class="cookie-consent-modal">
    <div class="cookie-icon">üåê</div>
    
    <h3>{% trans "Choose Language" %}</h3>
    <p>{% trans "Please select your preferred language" %}</p>
    
    <div class="cookie-buttons">
      <button class="cookie-btn accept language-option {% if CURRENT_LANG == 'en' %}selected{% endif %}" data-lang="en" data-url="/">
        üá¨üáß English
      </button>
      
      <button class="cookie-btn decline language-option {% if CURRENT_LANG == 'uk' %}selected{% endif %}" data-lang="uk" data-url="/uk/">
        üá∫üá¶ –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞
      </button>
      
      <button class="cookie-btn decline language-option {% if CURRENT_LANG == 'pl' %}selected{% endif %}" data-lang="pl" data-url="/pl/">
        üáµüá± Polski
      </button>
    </div>
  </div>
</div>

<style>
/* –î–æ–¥–∞—Ç–∫–æ–≤—ñ —Å—Ç–∏–ª—ñ –¥–ª—è –º–æ–¥–∞–ª–∫–∏ –≤–∏–±–æ—Ä—É –º–æ–≤–∏ */
.language-option.selected {
  background: var(--accent-green) !important;
  color: var(--primary-black) !important;
  border-color: var(--accent-green) !important;
}

.language-option.selected:hover {
  background: rgba(158, 255, 0, 0.9) !important;
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(158, 255, 0, 0.3);
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const languageOverlay = document.getElementById('languageSelectorOverlay');
  const languageOptions = document.querySelectorAll('.language-option');
  
  // –ü–æ–∫–∞–∑—É—î–º–æ –º–æ–¥–∞–ª–∫—É –≤–∏–±–æ—Ä—É –º–æ–≤–∏ –ø—ñ—Å–ª—è cookie consent
  function showLanguageSelector() {
    // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–∂–µ –æ–±—Ä–∞–≤ –º–æ–≤—É
    const selectedLanguage = sessionStorage.getItem('user_language_selected');
    const currentPath = window.location.pathname;
    
    // –ü–æ–∫–∞–∑—É—î–º–æ –º–æ–¥–∞–ª–∫—É —Ç—ñ–ª—å–∫–∏ –Ω–∞ –≥–æ–ª–æ–≤–Ω—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ
    const isHomePage = currentPath === '/' || currentPath === '/uk/' || currentPath === '/pl/' || currentPath === '/en/';
    if (!isHomePage) {
      return;
    }
    
    // –í–∏–∑–Ω–∞—á–∞—î–º–æ –ø–æ—Ç–æ—á–Ω—É –º–æ–≤—É –∑ URL
    let currentLang = 'en'; // –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –∞–Ω–≥–ª—ñ–π—Å—å–∫–∞
    if (currentPath.startsWith('/uk/') || currentPath === '/uk') {
      currentLang = 'uk';
    } else if (currentPath.startsWith('/pl/') || currentPath === '/pl') {
      currentLang = 'pl';
    }
    
    // –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–∂–µ –æ–±—Ä–∞–≤ –º–æ–≤—É, –Ω–µ –ø–æ–∫–∞–∑—É—î–º–æ –º–æ–¥–∞–ª–∫—É
    if (selectedLanguage) {
      return;
    }
    
    // –ü–æ–∫–∞–∑—É—î–º–æ –º–æ–¥–∞–ª–∫—É –∑ –∞–Ω—ñ–º–∞—Ü—ñ—î—é (—è–∫ cookie consent)
    languageOverlay.style.display = 'flex';
    setTimeout(() => {
      languageOverlay.classList.add('show');
    }, 10);
  }
  
  // –û–±—Ä–æ–±–∫–∞ –≤–∏–±–æ—Ä—É –º–æ–≤–∏
  languageOptions.forEach(option => {
    option.addEventListener('click', function() {
      const lang = this.dataset.lang;
      const currentPath = window.location.pathname;
      
      // –§–æ—Ä–º—É—î–º–æ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π URL –¥–ª—è –≤–∏–±—Ä–∞–Ω–æ—ó –º–æ–≤–∏
      let targetUrl = '/';
      
      if (lang === 'en') {
        // –î–ª—è –∞–Ω–≥–ª—ñ–π—Å—å–∫–æ—ó –º–æ–≤–∏ - –≥–æ–ª–æ–≤–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –±–µ–∑ –ø—Ä–µ—Ñ—ñ–∫—Å—É
        targetUrl = '/';
      } else {
        // –î–ª—è —ñ–Ω—à–∏—Ö –º–æ–≤ - –≥–æ–ª–æ–≤–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –∑ –º–æ–≤–Ω–∏–º –ø—Ä–µ—Ñ—ñ–∫—Å–æ–º
        targetUrl = `/${lang}/`;
      }
      
      // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≤–∏–±—ñ—Ä –≤ sessionStorage
      sessionStorage.setItem('user_language_selected', lang);
      sessionStorage.setItem('user_language_url', targetUrl);
      
      // –î–æ–¥–∞—î–º–æ –∫–ª–∞—Å selected –¥–æ –≤–∏–±—Ä–∞–Ω–æ—ó –æ–ø—Ü—ñ—ó
      languageOptions.forEach(opt => opt.classList.remove('selected'));
      this.classList.add('selected');
      
      // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—î–º–æ –Ω–∞ –≥–æ–ª–æ–≤–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É –≤–∏–±—Ä–∞–Ω–æ—ó –º–æ–≤–∏
      if (targetUrl !== currentPath) {
        window.location.href = targetUrl;
      } else {
        // –Ø–∫—â–æ –≤–∂–µ –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ, –ø—Ä–æ—Å—Ç–æ —Ö–æ–≤–∞—î–º–æ –º–æ–¥–∞–ª–∫—É
        hideLanguageSelector();
      }
    });
  });
  
  function hideLanguageSelector() {
    languageOverlay.classList.remove('show');
    setTimeout(() => {
      languageOverlay.style.display = 'none';
    }, 300);
  }
  
  // –ü–æ–∫–∞–∑—É—î–º–æ –º–æ–¥–∞–ª–∫—É –ø—ñ—Å–ª—è cookie consent
  const acceptBtn = document.getElementById('acceptCookies');
  const declineBtn = document.getElementById('declineCookies');
  
  if (acceptBtn) {
    acceptBtn.addEventListener('click', function() {
      setTimeout(showLanguageSelector, 500); // –ù–µ–≤–µ–ª–∏–∫–∞ –∑–∞—Ç—Ä–∏–º–∫–∞ –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç—ñ
    });
  }
  
  if (declineBtn) {
    declineBtn.addEventListener('click', function() {
      setTimeout(showLanguageSelector, 500);
    });
  }
  
  // –Ø–∫—â–æ cookie consent –≤–∂–µ –ø—Ä–∏–π–Ω—è—Ç–æ, –ø–æ–∫–∞–∑—É—î–º–æ –º–æ–¥–∞–ª–∫—É –º–æ–≤–∏
  const cookieConsent = localStorage.getItem('cookie_consent');
  if (cookieConsent && !sessionStorage.getItem('user_language_selected')) {
    setTimeout(showLanguageSelector, 1000);
  }
});
</script>
