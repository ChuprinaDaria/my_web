{% load i18n %}
{% get_current_language as CURRENT_LANG %}

<div id="languageSelectorOverlay" class="language-selector-overlay" style="display: none;">
  <div class="language-selector-modal">
    <div class="language-icon">üåê</div>
    
    <h3>{% trans "Choose Language" %}</h3>
    <p>{% trans "Please select your preferred language" %}</p>
    
    <div class="language-options">
      <button class="language-option {% if CURRENT_LANG == 'en' %}selected{% endif %}" data-lang="en" data-url="/">
        <span class="flag">üá¨üáß</span>
        <span class="lang-name">English</span>
      </button>
      
      <button class="language-option {% if CURRENT_LANG == 'uk' %}selected{% endif %}" data-lang="uk" data-url="/uk/">
        <span class="flag">üá∫üá¶</span>
        <span class="lang-name">–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</span>
      </button>
      
      <button class="language-option {% if CURRENT_LANG == 'pl' %}selected{% endif %}" data-lang="pl" data-url="/pl/">
        <span class="flag">üáµüá±</span>
        <span class="lang-name">Polski</span>
      </button>
    </div>
  </div>
</div>

<style>
.language-selector-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 10000;
  backdrop-filter: blur(5px);
}

.language-selector-modal {
  background: white;
  border-radius: 20px;
  padding: 40px;
  text-align: center;
  max-width: 500px;
  width: 90%;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
  animation: slideIn 0.3s ease-out;
}

@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateY(-30px) scale(0.9);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

.language-icon {
  font-size: 48px;
  margin-bottom: 20px;
}

.language-selector-modal h3 {
  color: #333;
  margin-bottom: 10px;
  font-size: 24px;
  font-weight: 600;
}

.language-selector-modal p {
  color: #666;
  margin-bottom: 30px;
  font-size: 16px;
}

.language-options {
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.language-option {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 15px;
  padding: 15px 25px;
  border: 2px solid #e0e0e0;
  border-radius: 12px;
  background: white;
  cursor: pointer;
  transition: all 0.3s ease;
  font-size: 16px;
  font-weight: 500;
}

.language-option:hover {
  border-color: #007bff;
  background: #f8f9ff;
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(0, 123, 255, 0.2);
}

.language-option.selected {
  border-color: #007bff;
  background: #007bff;
  color: white;
}

.language-option.selected:hover {
  background: #0056b3;
}

.flag {
  font-size: 24px;
}

.lang-name {
  font-size: 16px;
}

@media (max-width: 768px) {
  .language-selector-modal {
    padding: 30px 20px;
    margin: 20px;
  }
  
  .language-options {
    gap: 12px;
  }
  
  .language-option {
    padding: 12px 20px;
    font-size: 15px;
  }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const languageOverlay = document.getElementById('languageSelectorOverlay');
  const languageOptions = document.querySelectorAll('.language-option');
  
  // –ü–æ–∫–∞–∑—É—î–º–æ –º–æ–¥–∞–ª–∫—É –≤–∏–±–æ—Ä—É –º–æ–≤–∏ –ø—ñ—Å–ª—è cookie consent
  function showLanguageSelector() {
    // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–∂–µ –æ–±—Ä–∞–≤ –º–æ–≤—É
    const selectedLanguage = sessionStorage.getItem('user_language_selected');
    const currentPath = window.location.pathname;
    
    // –í–∏–∑–Ω–∞—á–∞—î–º–æ –ø–æ—Ç–æ—á–Ω—É –º–æ–≤—É –∑ URL
    let currentLang = 'en';
    if (currentPath.startsWith('/uk/') || currentPath === '/uk') {
      currentLang = 'uk';
    } else if (currentPath.startsWith('/pl/') || currentPath === '/pl') {
      currentLang = 'pl';
    }
    
    // –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–∂–µ –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ–π –º–æ–≤—ñ, –Ω–µ –ø–æ–∫–∞–∑—É—î–º–æ –º–æ–¥–∞–ª–∫—É
    if (selectedLanguage === currentLang) {
      return;
    }
    
    // –ü–æ–∫–∞–∑—É—î–º–æ –º–æ–¥–∞–ª–∫—É
    languageOverlay.style.display = 'flex';
    
    // –î–æ–¥–∞—î–º–æ –∫–ª–∞—Å –¥–ª—è –∞–Ω—ñ–º–∞—Ü—ñ—ó
    setTimeout(() => {
      languageOverlay.style.opacity = '1';
    }, 10);
  }
  
  // –û–±—Ä–æ–±–∫–∞ –≤–∏–±–æ—Ä—É –º–æ–≤–∏
  languageOptions.forEach(option => {
    option.addEventListener('click', function() {
      const lang = this.dataset.lang;
      const url = this.dataset.url;
      
      // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≤–∏–±—ñ—Ä –≤ sessionStorage
      sessionStorage.setItem('user_language_selected', lang);
      sessionStorage.setItem('user_language_url', url);
      
      // –î–æ–¥–∞—î–º–æ –∫–ª–∞—Å selected –¥–æ –≤–∏–±—Ä–∞–Ω–æ—ó –æ–ø—Ü—ñ—ó
      languageOptions.forEach(opt => opt.classList.remove('selected'));
      this.classList.add('selected');
      
      // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—î–º–æ –Ω–∞ –≤–∏–±—Ä–∞–Ω—É –º–æ–≤—É
      if (url !== window.location.pathname) {
        window.location.href = url;
      } else {
        // –Ø–∫—â–æ –≤–∂–µ –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ, –ø—Ä–æ—Å—Ç–æ —Ö–æ–≤–∞—î–º–æ –º–æ–¥–∞–ª–∫—É
        hideLanguageSelector();
      }
    });
  });
  
  function hideLanguageSelector() {
    languageOverlay.style.opacity = '0';
    setTimeout(() => {
      languageOverlay.style.display = 'none';
    }, 300);
  }
  
  // –ü–æ–∫–∞–∑—É—î–º–æ –º–æ–¥–∞–ª–∫—É –ø—ñ—Å–ª—è cookie consent
  const acceptBtn = document.getElementById('acceptCookies');
  const declineBtn = document.getElementById('declineCookies');
  
  if (acceptBtn) {
    acceptBtn.addEventListener('click', function() {
      setTimeout(showLanguageSelector, 500); // –ù–µ–≤–µ–ª–∏–∫–∞ –∑–∞—Ç—Ä–∏–º–∫–∞ –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç—ñ
    });
  }
  
  if (declineBtn) {
    declineBtn.addEventListener('click', function() {
      setTimeout(showLanguageSelector, 500);
    });
  }
  
  // –Ø–∫—â–æ cookie consent –≤–∂–µ –ø—Ä–∏–π–Ω—è—Ç–æ, –ø–æ–∫–∞–∑—É—î–º–æ –º–æ–¥–∞–ª–∫—É –º–æ–≤–∏
  const cookieConsent = localStorage.getItem('cookie_consent');
  if (cookieConsent && !sessionStorage.getItem('user_language_selected')) {
    setTimeout(showLanguageSelector, 1000);
  }
});
</script>
