{% load static i18n %}
{% get_current_language as CURRENT_LANG %}

<!-- üöÄ QUICK CTA + FULL FORM –¥–ª—è –≥–æ–ª–æ–≤–Ω–æ—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏ -->
<div class="container">
  
  <!-- –®–≤–∏–¥–∫–∏–π CTA –±–ª–æ–∫ -->
  <div class="quick-cta-section">
    <h2 class="quick-cta-title">
      {% if CURRENT_LANG == 'uk' %}–ì–æ—Ç–æ–≤—ñ –ø–æ—á–∞—Ç–∏?
      {% elif CURRENT_LANG == 'pl' %}Gotowy zaczƒÖƒá?
      {% else %}Ready to start?{% endif %}
    </h2>
    
    <div class="quick-cta-buttons">
      <!-- Quick consultation button -->
      <button class="btn-consultation-quick" onclick="openConsultationModal()">
        {% if CURRENT_LANG == 'uk' %}–ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—è
        {% elif CURRENT_LANG == 'pl' %}Darmowa konsultacja  
        {% else %}Free consultation{% endif %}
      </button>
      
      <!-- –ê–±–æ —Ä–æ–∑–≥–æ—Ä–Ω—É—Ç–∏ –ø–æ–≤–Ω—É —Ñ–æ—Ä–º—É -->
      <button class="btn-show-form" onclick="toggleFullForm()">
        {% if CURRENT_LANG == 'uk' %}–î–µ—Ç–∞–ª—å–Ω–∏–π –∑–∞–ø–∏—Ç
        {% elif CURRENT_LANG == 'pl' %}Szczeg√≥≈Çowe zapytanie
        {% else %}Detailed request{% endif %}
      </button>
    </div>
  </div>

  <!-- –ü–æ–≤–Ω–∞ —Ñ–æ—Ä–º–∞ (—Å–ø–æ—á–∞—Ç–∫—É –ø—Ä–∏—Ö–æ–≤–∞–Ω–∞) -->
  <div class="full-contact-form" id="fullContactForm" style="display: none;">
    <div class="card contact-form-card">
      
      <h3 class="form-title">
        {% if CURRENT_LANG == 'uk' %}–†–æ–∑–∫–∞–∂—ñ—Ç—å –ø—Ä–æ –≤–∞—à –ø—Ä–æ—î–∫—Ç
        {% elif CURRENT_LANG == 'pl' %}Opowiedz o swoim projekcie
        {% else %}Tell us about your project{% endif %}
      </h3>
      
      <form id="homeContactForm" class="contact-form-detailed" action="{% url 'contacts:submit_form' %}" method="post">
        {% csrf_token %}
        
        <div class="form-row">
          <div class="form-group">
            <input type="text" name="name" placeholder="{% trans '–í–∞—à–µ —ñ–º\'—è' %}" required class="form-input">
          </div>
          
          <div class="form-group">
            <input type="email" name="email" placeholder="Email" required class="form-input">
          </div>
        </div>
        
        <div class="form-group">
          <input type="text" name="subject" placeholder="{% trans '–¢–µ–º–∞ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥: –ß–∞—Ç-–±–æ—Ç –¥–ª—è —Å–∞–π—Ç—É)' %}" required class="form-input">
        </div>
        
        <div class="form-group">
          <textarea name="message" rows="4" required class="form-textarea"
                    placeholder="{% trans '–û–ø–∏—à—ñ—Ç—å —â–æ –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ, –≤–∞—à—ñ —Ü—ñ–ª—ñ —Ç–∞ –±—é–¥–∂–µ—Ç...' %}"></textarea>
        </div>
        
        <input type="hidden" name="referred_from" value="home_page_detailed">
        
        <button type="submit" class="btn-send-detailed">
          <span class="btn-text">
            {% if CURRENT_LANG == 'uk' %}–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –∑–∞–ø–∏—Ç
            {% elif CURRENT_LANG == 'pl' %}Wy≈õlij zapytanie
            {% else %}Send request{% endif %}
          </span>
          <span class="btn-loading" style="display: none;">
            {% trans "–ù–∞–¥—Å–∏–ª–∞—î–º–æ..." %}
          </span>
        </button>
        
        <div id="detailedFormMessage" class="form-message" style="display: none;"></div>
      </form>
      
    </div>
  </div>

  <!-- –®–≤–∏–¥–∫—ñ –∫–æ–Ω—Ç–∞–∫—Ç–∏ -->
  <div class="quick-contacts-bottom">
    <a href="mailto:hello@lazysoft.dev" class="quick-contact-link">
      <i data-lucide="mail"></i>
      hello@lazysoft.dev
    </a>
    
    <a href="tel:+48727842737" class="quick-contact-link">
      <i data-lucide="phone"></i>
      +48 727 842 737
    </a>
    
    <a href="{% url 'contacts:contact_page' %}" class="quick-contact-link">
      <i data-lucide="map-pin"></i>
      {% trans "–ü–æ–≤–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è" %}
    </a>
  </div>
  
</div>

<!-- MODAL –¥–ª—è —à–≤–∏–¥–∫–æ—ó –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—ó -->
<div id="consultationModal" class="consultation-modal" style="display: none;">
  <div class="modal-overlay" onclick="closeConsultationModal()"></div>
  <div class="modal-content">
    <button class="modal-close" onclick="closeConsultationModal()">√ó</button>
    
    <h3 class="modal-title">
      {% if CURRENT_LANG == 'uk' %}–ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—è
      {% elif CURRENT_LANG == 'pl' %}Darmowa konsultacja
      {% else %}Free consultation{% endif %}
    </h3>
    
    <p class="modal-subtitle">
      {% if CURRENT_LANG == 'uk' %}–ó–∞–ª–∏—à—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç–∏ —ñ –º–∏ –∑–≤'—è–∂–µ–º–æ—Å—è –ø—Ä–æ—Ç—è–≥–æ–º –≥–æ–¥–∏–Ω–∏
      {% elif CURRENT_LANG == 'pl' %}Zostaw kontakt, odezwiemy siƒô w ciƒÖgu godziny
      {% else %}Leave your contact, we'll reach out within an hour{% endif %}
    </p>
    
    <form id="quickConsultationForm" class="quick-form" action="{% url 'contacts:submit_form' %}" method="post">
      {% csrf_token %}
      
      <input type="text" name="name" placeholder="{% trans '–í–∞—à–µ —ñ–º\'—è' %}" required class="modal-input">
      <input type="email" name="email" placeholder="Email" required class="modal-input">
      <input type="tel" name="phone" placeholder="{% trans '–¢–µ–ª–µ—Ñ–æ–Ω (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)' %}" class="modal-input">
      
      <input type="hidden" name="subject" value="{% trans '–ó–∞–ø–∏—Ç –Ω–∞ –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω—É –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—é' %}">
      <input type="hidden" name="message" value="{% trans '–ö–ª—ñ—î–Ω—Ç –∑–∞–ø–∏—Ç–∞–≤ –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω—É –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—é —á–µ—Ä–µ–∑ —à–≤–∏–¥–∫—É —Ñ–æ—Ä–º—É –Ω–∞ –≥–æ–ª–æ–≤–Ω—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ.' %}">
      <input type="hidden" name="referred_from" value="home_page_quick_consultation">
      
      <button type="submit" class="btn-modal-submit">
        <span class="btn-text">
          {% if CURRENT_LANG == 'uk' %}–ó–∞–º–æ–≤–∏—Ç–∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—é
          {% elif CURRENT_LANG == 'pl' %}Zam√≥w konsultacjƒô
          {% else %}Book consultation{% endif %}
        </span>
        <span class="btn-loading" style="display: none;">...</span>
      </button>
      
      <div id="modalFormMessage" class="modal-message" style="display: none;"></div>
    </form>
  </div>
</div>

<script>
// –í—ñ–¥–∫—Ä–∏—Ç–∏/–∑–∞–∫—Ä–∏—Ç–∏ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ
function openConsultationModal() {
  document.getElementById('consultationModal').style.display = 'flex';
  document.body.style.overflow = 'hidden';
}

function closeConsultationModal() {
  document.getElementById('consultationModal').style.display = 'none';
  document.body.style.overflow = 'auto';
}

// –ü–æ–∫–∞–∑–∞—Ç–∏/—Å—Ö–æ–≤–∞—Ç–∏ –ø–æ–≤–Ω—É —Ñ–æ—Ä–º—É
function toggleFullForm() {
  const form = document.getElementById('fullContactForm');
  const btn = document.querySelector('.btn-show-form');
  
  if (form.style.display === 'none') {
    form.style.display = 'block';
    btn.textContent = '{% if CURRENT_LANG == "uk" %}–°—Ö–æ–≤–∞—Ç–∏ —Ñ–æ—Ä–º—É{% elif CURRENT_LANG == "pl" %}Ukryj formularz{% else %}Hide form{% endif %}';
    form.scrollIntoView({ behavior: 'smooth' });
  } else {
    form.style.display = 'none';
    btn.textContent = '{% if CURRENT_LANG == "uk" %}–î–µ—Ç–∞–ª—å–Ω–∏–π –∑–∞–ø–∏—Ç{% elif CURRENT_LANG == "pl" %}Szczeg√≥≈Çowe zapytanie{% else %}Detailed request{% endif %}';
  }
}

// –û–±—Ä–æ–±–∫–∞ —à–≤–∏–¥–∫–æ—ó —Ñ–æ—Ä–º–∏ –≤ –º–æ–¥–∞–ª—Ü—ñ
document.getElementById('quickConsultationForm').addEventListener('submit', async function(e) {
  e.preventDefault();
  
  const form = this;
  const submitBtn = form.querySelector('.btn-modal-submit');
  const btnText = submitBtn.querySelector('.btn-text');
  const btnLoading = submitBtn.querySelector('.btn-loading');
  const messageDiv = document.getElementById('modalFormMessage');
  
  submitBtn.disabled = true;
  btnText.style.display = 'none';
  btnLoading.style.display = 'inline';
  
  try {
    const formData = new FormData(form);
    const response = await fetch(form.action, {
      method: 'POST',
      body: formData,
      headers: { 'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value }
    });
    
    const result = await response.json();
    
    if (result.success) {
      messageDiv.className = 'modal-message success';
      messageDiv.innerHTML = 'üéâ {% if CURRENT_LANG == "uk" %}–î—è–∫—É—î–º–æ! –ó–≤\'—è–∂–µ–º–æ—Å—è –ø—Ä–æ—Ç—è–≥–æ–º –≥–æ–¥–∏–Ω–∏!{% elif CURRENT_LANG == "pl" %}Dziƒôkujemy! Odezwiemy siƒô w ciƒÖgu godziny!{% else %}Thank you! We\'ll contact you within an hour!{% endif %}';
      form.reset();
      
      // –ó–∞–∫—Ä–∏–≤–∞—î–º–æ –º–æ–¥–∞–ª–∫—É —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥–∏
      setTimeout(() => closeConsultationModal(), 2000);
    } else {
      messageDiv.className = 'modal-message error';
      messageDiv.innerHTML = '‚ùå ' + (result.error || '–ü–æ–º–∏–ª–∫–∞');
    }
  } catch (error) {
    messageDiv.className = 'modal-message error';
    messageDiv.innerHTML = '‚ùå –ü–æ–º–∏–ª–∫–∞ –º–µ—Ä–µ–∂—ñ';
  }
  
  submitBtn.disabled = false;
  btnText.style.display = 'inline';
  btnLoading.style.display = 'none';
  messageDiv.style.display = 'block';
});

// –û–±—Ä–æ–±–∫–∞ –¥–µ—Ç–∞–ª—å–Ω–æ—ó —Ñ–æ—Ä–º–∏
document.getElementById('homeContactForm').addEventListener('submit', async function(e) {
  e.preventDefault();
  
  const form = this;
  const submitBtn = form.querySelector('.btn-send-detailed');
  const btnText = submitBtn.querySelector('.btn-text');
  const btnLoading = submitBtn.querySelector('.btn-loading');
  const messageDiv = document.getElementById('detailedFormMessage');
  
  submitBtn.disabled = true;
  btnText.style.display = 'none';
  btnLoading.style.display = 'inline';
  
  try {
    const formData = new FormData(form);
    const response = await fetch(form.action, {
      method: 'POST',
      body: formData,
      headers: { 'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value }
    });
    
    const result = await response.json();
    
    if (result.success) {
      messageDiv.className = 'form-message success';
      messageDiv.textContent = result.message || '–î—è–∫—É—î–º–æ! –í–∞—à –∑–∞–ø–∏—Ç –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ.';
      form.reset();
    } else {
      messageDiv.className = 'form-message error';
      messageDiv.textContent = result.error || '–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤—ñ–¥–ø—Ä–∞–≤—Ü—ñ';
    }
  } catch (error) {
    messageDiv.className = 'form-message error';
    messageDiv.textContent = '–ü–æ–º–∏–ª–∫–∞ –º–µ—Ä–µ–∂—ñ';
  }
  
  submitBtn.disabled = false;
  btnText.style.display = 'inline';
  btnLoading.style.display = 'none';
  messageDiv.style.display = 'block';
  
  setTimeout(() => messageDiv.style.display = 'none', 4000);
});
</script>