{% extends "core/base.html" %}
{% load static i18n %}
{% get_current_language as CURRENT_LANG %}

{% block title %}{{ page_title }}{% endblock %}
{% block meta_description %}{{ page_description }}{% endblock %}
{% block og_title %}{{ page_title }}{% endblock %}
{% block og_description %}{{ page_description }}{% endblock %}
{% block og_image %}https://lazysoft.dev/static/images/news-og.jpg{% endblock %}

{% block extra_meta %}
  <link rel="canonical" href="https://lazysoft.dev{{ request.path }}" />
  
  <!-- Hreflang -->
  <link rel="alternate" href="https://lazysoft.dev/en/news/" hreflang="en">
  <link rel="alternate" href="https://lazysoft.dev/uk/news/" hreflang="uk">
  <link rel="alternate" href="https://lazysoft.dev/pl/news/" hreflang="pl">
  
  <!-- Styles -->
  <link rel="stylesheet" href="{% static 'css/sections/news_list.css' %}">
  <link rel="stylesheet" href="{% static 'css/sidebar_desktop.css' %}?v=1.3">
  <link rel="stylesheet" href="{% static 'css/sidebar_mobile.css' %}?v=1.3">
  
  <!-- Structured Data -->
  <script type="application/ld+json">
  {{ structured_data|safe }}
  </script>
{% endblock %}

{% block content %}
<main class="news-page">

  <!-- Hero Section -->
  <section class="news-header py-16">
    <div class="container max-w-4xl mx-auto text-center">
      {% if current_category %}
        <!-- Category Page -->
        <div style="display: flex; justify-content: center; align-items: center; margin-bottom: 20px;">
          <span style="font-size: 4rem; margin-right: 20px;">{{ current_category.icon }}</span>
          <div>
            <h1>{{ current_category.get_name|safe }}</h1>
          </div>
        </div>
        <p>{{ current_category.get_description|safe }}</p>
      {% else %}
        <!-- Main News Page -->
        <h1>{% trans "TECH INSIGHTS by LAZYSOFT" %}</h1>
        
        <p>{% trans "Not just news ‚Äî business insights for European entrepreneurs" %}</p>
      {% endif %}
    </div>
  </section>

  
  <!-- Category CTA -->
  {% if current_category and current_category.cta_title_uk %}
  <section class="category-cta py-8">
    <div class="container max-w-4xl mx-auto">
      <div class="service-card" style="text-align: center;">
        <div class="service-text">
          <h3>{{ current_category.get_cta_title|safe }}</h3>
          
          <p>{{ current_category.get_cta_description|safe }}</p>
          
          <a href="{{ current_category.cta_link }}" 
             style="display: inline-block; margin-top: 15px; padding: 12px 30px; background: var(--accent-green); color: black; border-radius: 25px; text-decoration: none; font-weight: bold;">
            {{ current_category.get_cta_button_text }} ‚Üí
          </a>
        </div>
      </div>
    </div>
  </section>
  {% endif %}

  <!-- –ù–û–í–ò–ô LAYOUT: Content + Sidebar -->
  <section class="news-main-section">
    <div class="container">
      <div class="news-layout">
        
        <!-- Main Content Column -->
        <div class="news-content">
          
          {% if articles %}
            <!-- News Grid (–∑–∞–º—ñ—Å—Ç—å –∫–∞—Ä—É—Å–µ–ª—å) -->
            <div class="news-grid">
              {% for article in articles %}
              <article class="news-card clickable" data-href="{{ article.get_absolute_url }}">
                
                <!-- AI Generated Image -->
                {% if article.ai_image_url %}
                  <img src="{{ article.ai_image_url }}" 
                       alt="{{ article.get_title }}" 
                       loading="lazy"
                       class="news-image">
                {% endif %}
                
                <!-- Category & Meta -->
                <div class="news-meta">
                  <span class="category-chip">
                    {{ article.category.icon }}
                    {{ article.category.get_name }}
                  </span>
                  
                  {% if article.is_top_article %}
                    <span class="top-chip">üèÜ TOP</span>
                  {% endif %}
                  
                  {% if article.priority >= 3 %}
                    <span class="hot-chip">üî• HOT</span>
                  {% endif %}
                </div>

                <!-- Article Title -->
                <h3>
                  {{ article.get_title|safe }}
                </h3>

                <!-- Summary -->
                <p class="news-summary">
                  {{ article.get_summary|safe|truncatewords:15 }}
                </p>

                <!-- Footer Info -->
                <div class="news-footer">
                  <time datetime="{{ article.published_at|date:'c' }}" class="news-date">
                    <i data-lucide="calendar"></i>
                    {{ article.published_at|date:'j.m.Y' }}
                  </time>
                  <span class="news-views">
                    <i data-lucide="eye"></i>
                    {{ article.get_total_views }}
                  </span>
                  <span class="news-time">
                    <i data-lucide="clock"></i>
                    {{ article.get_reading_time }}—Ö–≤
                  </span>
                  {% if article.original_source_url and article.original_source_name %}
                    <a href="{{ article.original_source_url }}" target="_blank" rel="nofollow noopener" class="source-link">
                      <i data-lucide="external-link"></i>
                      {{ article.original_source_name }}
                    </a>
                  {% endif %}
                  <span class="read-more">
                    <i data-lucide="arrow-right"></i>
                  </span>
                </div>
              </article>
              {% endfor %}
            </div>

            <!-- Pagination -->
            {% if is_paginated %}
            <nav class="pagination-nav">
              {% if page_obj.has_previous %}
              <a href="?page={{ page_obj.previous_page_number }}" class="pagination-btn">
                <i data-lucide="chevron-left"></i>
                <span>{% trans "Previous" %}</span>
              </a>
              {% endif %}
              
              <span class="pagination-current">
                {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}
              </span>
              
              {% if page_obj.has_next %}
              <a href="?page={{ page_obj.next_page_number }}" class="pagination-btn">
                <span>{% trans "Next" %}</span>
                <i data-lucide="chevron-right"></i>
              </a>
              {% endif %}
            </nav>
            {% endif %}
            
          {% else %}
            <!-- No Articles -->
            <div class="empty-state">
              <div class="empty-icon">
                <i data-lucide="newspaper"></i>
              </div>
              <h2>{% trans "No news yet in this category" %}</h2>
              <p>{% trans "Fresh tech insights are coming soon. Check back later!" %}</p>
              <a href="{% url 'news:news_list' %}" class="back-link">
                <i data-lucide="chevron-left"></i>
                <span>{% trans "View all news" %}</span>
              </a>
            </div>
          {% endif %}
          
        </div>

        <!-- Sidebar Column -->
        <aside class="news-sidebar">
          {% include 'includes/news_sidebar.html' %}
        </aside>

      </div>
    </div>
  </section>

  <!-- Services Cross-Promo -->
  {% include 'includes/related_work_section.html' %}
  

  <!-- Social Sharing -->
  {% include 'includes/social_share.html' %}

</main>
{% endblock %}

{% block extra_scripts %}
<script src="{% static 'js/services_sidebar.js' %}"></script>
<script>
// Initialize Lucide icons
document.addEventListener('DOMContentLoaded', function() {
  if (typeof lucide !== 'undefined') {
    lucide.createIcons();
  }
});
</script>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": "{{ page_title|escapejs }}",
  "description": "{{ page_description|escapejs }}",
  "url": "https://lazysoft.dev{{ request.path }}",
  "inLanguage": "{{ CURRENT_LANG }}",
  "publisher": {
    "@type": "Organization",
    "name": "LAZYSOFT",
    "logo": {
      "@type": "ImageObject",
      "url": "https://lazysoft.dev/static/images/logo.png"
    }
  },
  "mainEntity": {
    "@type": "ItemList",
    "itemListElement": [
      {% for article in articles %}
      {
        "@type": "ListItem",
        "position": {{ forloop.counter }},
        "url": "https://lazysoft.dev{{ article.get_absolute_url }}",
        "name": "{{ article.get_title|escapejs }}"
      }{% if not forloop.last %},{% endif %}
      {% endfor %}
    ]
  }
}
</script>
{% endblock %}