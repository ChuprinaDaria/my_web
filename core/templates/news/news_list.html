{% extends "core/base.html" %}
{% load static i18n %}
{% get_current_language as CURRENT_LANG %}

{% block title %}{{ page_title }}{% endblock %}
{% block meta_description %}{{ page_description }}{% endblock %}
{% block og_title %}{{ page_title }}{% endblock %}
{% block og_description %}{{ page_description }}{% endblock %}
{% block og_image %}https://lazysoft.dev/static/images/news-og.jpg{% endblock %}

{% block extra_meta %}
  <link rel="canonical" href="https://lazysoft.dev{{ request.path }}" />
  
  <!-- Hreflang -->
  <link rel="alternate" href="https://lazysoft.dev/en/news/" hreflang="en">
  <link rel="alternate" href="https://lazysoft.dev/uk/news/" hreflang="uk">
  <link rel="alternate" href="https://lazysoft.dev/pl/news/" hreflang="pl">
  
  <!-- Styles -->
  <link rel="stylesheet" href="{% static 'css/sections/news_list.css' %}">
  <link rel="stylesheet" href="{% static 'css/components/news_sidebar.css' %}">
  
  <!-- Structured Data -->
  <script type="application/ld+json">
  {{ structured_data|safe }}
  </script>
{% endblock %}

{% block content %}
<main class="news-page">

  <!-- Hero Section -->
  <section class="news-header py-16">
    <div class="container max-w-4xl mx-auto text-center">
      {% if current_category %}
        <!-- Category Page -->
        <div style="display: flex; justify-content: center; align-items: center; margin-bottom: 20px;">
          <span style="font-size: 4rem; margin-right: 20px;">{{ current_category.icon }}</span>
          <div>
            <h1 data-lang="en">{{ current_category.name_en|safe }}</h1>
            <h1 data-lang="uk" class="active">{{ current_category.name_uk|safe }}</h1>
            <h1 data-lang="pl">{{ current_category.name_pl|safe }}</h1>
          </div>
        </div>
        <p data-lang="en">{{ current_category.description_en|safe }}</p>
        <p data-lang="uk" class="active">{{ current_category.description_uk|safe }}</p>
        <p data-lang="pl">{{ current_category.description_pl|safe }}</p>
      {% else %}
        <!-- Main News Page -->
        <h1 class="neon-text" data-lang="en">TECH INSIGHTS by LAZYSOFT</h1>
        <h1 class="neon-text" data-lang="uk" class="active">TECH –Ü–ù–°–ê–ô–¢–ò –≤—ñ–¥ LAZYSOFT</h1>
        <h1 class="neon-text" data-lang="pl">TECH INSIGHTS od LAZYSOFT</h1>
        
        <p data-lang="en">Not just news ‚Äî business insights for European entrepreneurs</p>
        <p data-lang="uk" class="active">–ù–µ –ø—Ä–æ—Å—Ç–æ –Ω–æ–≤–∏–Ω–∏ ‚Äî –±—ñ–∑–Ω–µ—Å-—ñ–Ω—Å–∞–π—Ç–∏ –¥–ª—è —î–≤—Ä–æ–ø–µ–π—Å—å–∫–∏—Ö –ø—ñ–¥–ø—Ä–∏—î–º—Ü—ñ–≤</p>
        <p data-lang="pl">Nie tylko wiadomo≈õci ‚Äî biznesowe wglƒÖdy dla europejskich przedsiƒôbiorc√≥w</p>
      {% endif %}
    </div>
  </section>

  <!-- Category CTA -->
  {% if current_category and current_category.cta_title_uk %}
  <section class="category-cta py-8">
    <div class="container max-w-4xl mx-auto">
      <div class="service-card" style="text-align: center;">
        <div class="service-text">
          <h3 data-lang="en">{{ current_category.cta_title_en|safe }}</h3>
          <h3 data-lang="uk" class="active">{{ current_category.cta_title_uk|safe }}</h3>
          <h3 data-lang="pl">{{ current_category.cta_title_pl|safe }}</h3>
          
          <p data-lang="en">{{ current_category.cta_description_en|safe }}</p>
          <p data-lang="uk" class="active">{{ current_category.cta_description_uk|safe }}</p>
          <p data-lang="pl">{{ current_category.cta_description_pl|safe }}</p>
          
          <a href="{{ current_category.cta_link }}" 
             style="display: inline-block; margin-top: 15px; padding: 12px 30px; background: var(--accent-green); color: black; border-radius: 25px; text-decoration: none; font-weight: bold;">
            <span data-lang="en">{{ current_category.cta_button_text_en }} ‚Üí</span>
            <span data-lang="uk" class="active">{{ current_category.cta_button_text_uk }} ‚Üí</span>
            <span data-lang="pl">{{ current_category.cta_button_text_pl }} ‚Üí</span>
          </a>
        </div>
      </div>
    </div>
  </section>
  {% endif %}

  <!-- –ù–û–í–ò–ô LAYOUT: Content + Sidebar -->
  <section class="news-main-section">
    <div class="container">
      <div class="news-layout">
        
        <!-- Main Content Column -->
        <div class="news-content">
          
          {% if articles %}
            <!-- News Grid (–∑–∞–º—ñ—Å—Ç—å –∫–∞—Ä—É—Å–µ–ª—å) -->
            <div class="news-grid">
              {% for article in articles %}
              <article class="news-card clickable" data-href="{{ article.get_absolute_url }}">
                
                <!-- AI Generated Image -->
                {% if article.ai_image_url %}
                  <img src="{{ article.ai_image_url }}" 
                       alt="{{ article.get_title }}" 
                       loading="lazy"
                       class="news-image">
                {% endif %}
                
                <!-- Category & Meta -->
                <div class="news-meta">
                  <span class="category-chip">
                    {{ article.category.icon }}
                    <span data-lang="en">{{ article.category.name_en }}</span>
                    <span data-lang="uk" class="active">{{ article.category.name_uk }}</span>
                    <span data-lang="pl">{{ article.category.name_pl }}</span>
                  </span>
                  
                  {% if article.is_top_article %}
                    <span class="top-chip">üèÜ TOP</span>
                  {% endif %}
                  
                  {% if article.priority >= 3 %}
                    <span class="hot-chip">üî• HOT</span>
                  {% endif %}
                </div>

                <!-- Article Title -->
                <h3 class="news-title">
                  <span data-lang="en">{{ article.title_en|safe }}</span>
                  <span data-lang="uk" class="active">{{ article.title_uk|safe }}</span>
                  <span data-lang="pl">{{ article.title_pl|safe }}</span>
                </h3>

                <!-- Summary -->
                <p class="news-summary">
                  <span data-lang="en">{{ article.summary_en|safe|truncatewords:15 }}</span>
                  <span data-lang="uk" class="active">{{ article.summary_uk|safe|truncatewords:15 }}</span>
                  <span data-lang="pl">{{ article.summary_pl|safe|truncatewords:15 }}</span>
                </p>

                <!-- Footer Info -->
                <div class="news-footer">
                  <time datetime="{{ article.published_at|date:'c' }}" class="news-date">
                    <i data-lucide="calendar"></i>
                    {{ article.published_at|date:'j.m.Y' }}
                  </time>
                  <span class="news-views">
                    <i data-lucide="eye"></i>
                    {{ article.get_total_views }}
                  </span>
                  <span class="news-time">
                    <i data-lucide="clock"></i>
                    {{ article.get_reading_time }}—Ö–≤
                  </span>
                  {% if article.original_source_url and article.original_source_name %}
                    <a href="{{ article.original_source_url }}" target="_blank" rel="nofollow noopener" class="source-link">
                      <i data-lucide="external-link"></i>
                      {{ article.original_source_name }}
                    </a>
                  {% endif %}
                  <span class="read-more">
                    <i data-lucide="arrow-right"></i>
                  </span>
                </div>
              </article>
              {% endfor %}
            </div>

            <!-- Pagination -->
            {% if is_paginated %}
            <nav class="pagination-nav">
              {% if page_obj.has_previous %}
              <a href="?page={{ page_obj.previous_page_number }}" class="pagination-btn">
                <i data-lucide="chevron-left"></i>
                <span data-lang="en">Previous</span>
                <span data-lang="uk" class="active">–ü–æ–ø–µ—Ä–µ–¥–Ω—è</span>
                <span data-lang="pl">Poprzednia</span>
              </a>
              {% endif %}
              
              <span class="pagination-current">
                {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}
              </span>
              
              {% if page_obj.has_next %}
              <a href="?page={{ page_obj.next_page_number }}" class="pagination-btn">
                <span data-lang="en">Next</span>
                <span data-lang="uk" class="active">–ù–∞—Å—Ç—É–ø–Ω–∞</span>
                <span data-lang="pl">Nastƒôpna</span>
                <i data-lucide="chevron-right"></i>
              </a>
              {% endif %}
            </nav>
            {% endif %}
            
          {% else %}
            <!-- No Articles -->
            <div class="empty-state">
              <div class="empty-icon">
                <i data-lucide="newspaper"></i>
              </div>
              <h2>
                <span data-lang="en">No news yet in this category</span>
                <span data-lang="uk" class="active">–ü–æ–∫–∏ —â–æ –Ω–µ–º–∞—î –Ω–æ–≤–∏–Ω –≤ —Ü—ñ–π –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó</span>
                <span data-lang="pl">Jeszcze brak wiadomo≈õci w tej kategorii</span>
              </h2>
              <p>
                <span data-lang="en">Fresh tech insights are coming soon. Check back later!</span>
                <span data-lang="uk" class="active">–°–≤—ñ–∂—ñ —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—á–Ω—ñ —ñ–Ω—Å–∞–π—Ç–∏ –∑'—è–≤–ª—è—Ç—å—Å—è –Ω–µ–∑–∞–±–∞—Ä–æ–º. –ü–æ–≤–µ—Ä—Ç–∞–π—Ç–µ—Å—è –ø—ñ–∑–Ω—ñ—à–µ!</span>
                <span data-lang="pl">≈öwie≈ºe technologiczne wglƒÖdy pojawiƒÖ siƒô wkr√≥tce. Sprawd≈∫ p√≥≈∫niej!</span>
              </p>
              <a href="{% url 'news:news_list' %}" class="back-link">
                <i data-lucide="chevron-left"></i>
                <span data-lang="en">View all news</span>
                <span data-lang="uk" class="active">–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –≤—Å—ñ –Ω–æ–≤–∏–Ω–∏</span>
                <span data-lang="pl">Zobacz wszystkie wiadomo≈õci</span>
              </a>
            </div>
          {% endif %}
          
        </div>

        <!-- Sidebar Column -->
        <aside class="news-sidebar">
          {% include 'includes/news_sidebar.html' %}
        </aside>

      </div>
    </div>
  </section>

  <!-- Social Sharing -->
  {% include 'includes/social_share.html' %}

</main>
{% endblock %}

{% block extra_scripts %}
<script>
// Initialize Lucide icons
document.addEventListener('DOMContentLoaded', function() {
  if (typeof lucide !== 'undefined') {
    lucide.createIcons();
  }
});
</script>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": "{{ page_title|escapejs }}",
  "description": "{{ page_description|escapejs }}",
  "url": "https://lazysoft.dev{{ request.path }}",
  "inLanguage": "{{ CURRENT_LANG }}",
  "publisher": {
    "@type": "Organization",
    "name": "LAZYSOFT",
    "logo": {
      "@type": "ImageObject",
      "url": "https://lazysoft.dev/static/images/logo.png"
    }
  },
  "mainEntity": {
    "@type": "ItemList",
    "itemListElement": [
      {% for article in articles %}
      {
        "@type": "ListItem",
        "position": {{ forloop.counter }},
        "url": "https://lazysoft.dev{{ article.get_absolute_url }}",
        "name": "{{ article.get_title|escapejs }}"
      }{% if not forloop.last %},{% endif %}
      {% endfor %}
    ]
  }
}
</script>
{% endblock %}