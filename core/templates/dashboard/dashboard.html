{% extends "core/base.html" %}
{% load static i18n %}
{% get_current_language as CURRENT_LANG %}

{# ---------- SEO / META ---------- #}
{% block title %}Executive Dashboard ‚Äî Lazysoft{% endblock %}

{% block meta_tags %}
  <meta name="description" content="Executive dashboard: KPIs, AI performance, engagement, ROI. Auto-refreshed analytics for Lazysoft.">
  <meta property="og:title" content="Executive Dashboard ‚Äî Lazysoft">
  <meta property="og:description" content="Realtime KPIs: content, AI efficiency, engagement, ROI, system health.">
  <meta property="og:image" content="https://lazysoft.dev/static/images/og-dashboard.jpg">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://lazysoft.dev{{ request.path }}">
  <link rel="canonical" href="https://lazysoft.dev{{ request.path }}" />
  {# Twitter #}
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Executive Dashboard ‚Äî Lazysoft">
  <meta name="twitter:description" content="Realtime KPIs: content, AI efficiency, engagement, ROI, system health.">
  <meta name="twitter:image" content="https://lazysoft.dev/static/images/og-dashboard.jpg">
{% endblock %}

{% block extra_meta %}
  {# hreflang ‚Äî —è–∫—â–æ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –ª–æ–∫–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ #}
  <link rel="alternate" href="https://lazysoft.dev/dashboard/" hreflang="en" />
  <link rel="alternate" href="https://lazysoft.dev/uk/dashboard/" hreflang="uk" />
  <link rel="alternate" href="https://lazysoft.dev/pl/dashboard/" hreflang="pl" />
{% endblock %}

{% block extra_head %}
  <link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
  {# JSON-LD #}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebPage",
    "name": "Executive Dashboard ‚Äî Lazysoft",
    "description": "Realtime KPIs: content, AI efficiency, engagement, ROI, system health.",
    "url": "https://lazysoft.dev{{ request.path }}",
    "inLanguage": "{{ CURRENT_LANG }}",
    "isPartOf": { "@type": "WebSite", "name": "Lazysoft", "url": "https://lazysoft.dev" }
  }
  </script>
{% endblock %}

{% block content %}
<section class="dash-hero glass">
  <div class="dash-hero__head">
    <h1>üöÄ {{ title }}</h1>
    <p>Executive Analytics &amp; Performance Dashboard</p>
  </div>

  <div class="dash-toolbar">
    <label class="dash-label">{% trans "–ü–µ—Ä—ñ–æ–¥" %}:</label>
    <select class="dash-select" onchange="window.location.href='?period='+this.value">
      {% for value, label in periods %}
        <option value="{{ value }}" {% if value == period %}selected{% endif %}>{{ label }}</option>
      {% endfor %}
    </select>

    <a class="btn btn--ghost" href="?period={{ period }}&export=json">üìÑ Export JSON</a>

    <div class="share">
      {# –°–æ—Ü. —à–∞—Ä—ñ–Ω–≥–∏ #}
      {% with page_url=request.build_absolute_uri title_str=title|urlencode %}
        <a class="share__link" target="_blank" rel="noopener" href="https://www.linkedin.com/shareArticle?mini=true&url={{ page_url }}&title={{ title_str }}">in</a>
        <a class="share__link" target="_blank" rel="noopener" href="https://twitter.com/intent/tweet?url={{ page_url }}&text={{ title_str }}">X</a>
        <a class="share__link" target="_blank" rel="noopener" href="https://www.facebook.com/sharer/sharer.php?u={{ page_url }}">f</a>
      {% endwith %}
    </div>
  </div>
</section>

<section class="kpi-grid">
  <article class="kpi-card glass">
    <div class="kpi-label">Content Production</div>
    <div class="kpi-value">{{ data.key_kpis.content_production.total_items }}</div>
    <div>Articles: {{ data.key_kpis.content_production.articles }}</div>
    <div>Projects: {{ data.key_kpis.content_production.projects }}</div>
    <div>{{ data.key_kpis.content_production.trend_icon }} Trend</div>
  </article>

  <article class="kpi-card glass">
    <div class="kpi-label">AI Performance</div>
    <div class="kpi-value kpi-dynamic" style="--kpi-color: {{ data.key_kpis.ai_efficiency.color }}">
      {{ data.key_kpis.ai_efficiency.success_rate }}%
    </div>
    <div>Cost: ${{ data.key_kpis.ai_efficiency.total_cost|floatformat:2 }}</div>
    <div>Efficiency: {{ data.key_kpis.ai_efficiency.efficiency_score|floatformat:1 }}/100</div>
  </article>

  <article class="kpi-card glass">
    <div class="kpi-label">Engagement</div>
    <div class="kpi-value kpi-dynamic" style="--kpi-color: {{ data.key_kpis.engagement_performance.color }}">
      {{ data.key_kpis.engagement_performance.total_views }}
    </div>
    <div>Rate: {{ data.key_kpis.engagement_performance.engagement_rate }}%</div>
    <div>Social Posts: {{ data.key_kpis.engagement_performance.social_posts }}</div>
  </article>

  <article class="kpi-card glass">
    <div class="kpi-label">ROI Performance</div>
    <div class="kpi-value kpi-dynamic" style="--kpi-color: {{ data.key_kpis.roi_performance.color }}">
      {{ data.key_kpis.roi_performance.total_roi }}%
    </div>
    <div>{{ data.key_kpis.roi_performance.roi_formatted }}</div>
    <div>Top: {{ data.key_kpis.roi_performance.top_category }}</div>
  </article>
</section>

<section class="panel glass">
  <h3>üìà Overall Performance</h3>
  <div class="kpi-value kpi-dynamic" style="--kpi-color: {{ data.performance_score.color }}">
    {{ data.performance_score.score }}/100
  </div>
  <div class="muted">Status: {{ data.performance_score.status }}</div>
</section>

<section class="panel glass">
  <h3>üí° Priority Recommendations</h3>
  <ul class="recs">
    {% for rec in data.recommendations %}
      <li class="rec-item">
        <span class="rec-icon">{{ rec.icon }}</span>
        <strong>{{ rec.priority }}</strong> ‚Äî {{ rec.text }}
      </li>
    {% endfor %}
  </ul>
</section>

<section class="panel glass">
  <h3>üè• System Health</h3>
  <div class="health-badge health--{{ data.health_check.status|default:'unknown'|lower }}">
    {{ data.health_check.status|upper }}
  </div>
  {% if data.health_check.issues %}
    <h4>Issues:</h4>
    <ul class="issues">
      {% for issue in data.health_check.issues %}
        <li class="issue">{{ issue }}</li>
      {% endfor %}
    </ul>
  {% endif %}
</section>

<div class="page-meta">
  <small class="muted">Generated at {{ data.generated_at }} | Period: {{ data.period }}</small>
</div>
{% endblock %}

{% block extra_scripts %}
  <script>
    // –∞–≤—Ç–æ-–æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Ä–∞–∑ –Ω–∞ 5 —Ö–≤
    setTimeout(() => window.location.reload(), 300000);
  </script>
{% endblock %}
