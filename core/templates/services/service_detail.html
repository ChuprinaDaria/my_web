{% extends "core/base.html" %}
{% load static i18n %}
{% get_current_language as CURRENT_LANG %}

{% block title %}{{ service.seo_title|default:service.title }} | Lazysoft{% endblock %}
{% block meta_description %}{{ service.seo_description|default:service.short|striptags|truncatewords:25 }}{% endblock %}
{% block og_title %}{{ service.title|striptags }}{% endblock %}
{% block og_description %}{{ service.short|striptags|truncatewords:30 }}{% endblock %}
{% block og_image %}{% if service.main_image %}https://lazysoft.dev{{ service.main_image.url }}{% else %}https://lazysoft.dev{% static 'images/services-og.jpg' %}{% endif %}{% endblock %}

{% block extra_meta %}
  <link rel="canonical" href="https://lazysoft.dev/{{ CURRENT_LANG }}/services/{{ service.slug }}/" />
  
  <link rel="alternate" href="https://lazysoft.dev/en/services/{{ service.slug }}/" hreflang="en">
  <link rel="alternate" href="https://lazysoft.dev/uk/services/{{ service.slug }}/" hreflang="uk">
  <link rel="alternate" href="https://lazysoft.dev/pl/services/{{ service.slug }}/" hreflang="pl">
  
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Service",
    "name": "{{ service.title|escapejs }}",
    "description": "{{ service.short|striptags|escapejs }}",
    "provider": {
      "@type": "Organization",
      "name": "Lazysoft",
      "url": "https://lazysoft.dev"
    },
    "areaServed": "Worldwide",
    {% if service.main_image %}"image": "https://lazysoft.dev{{ service.main_image.url }}",{% endif %}
    "url": "https://lazysoft.dev/{{ CURRENT_LANG }}/services/{{ service.slug }}/"
  }
  </script>
{% endblock %}

{% block content %}
<article class="service-detail-container">
  
  <section class="service-hero-section">
    <div class="container">
      <div class="hero-content">
        
        

        

        <h1>{{ service.title|safe }}</h1>
        
        <p>
          {% if service.short %}
            {{ service.short|safe|striptags|truncatewords:35 }}
          {% else %}
           {% if service.main_image %}
             <div class="service-hero-icon">
               <img src="{{ service.main_image.url }}" alt="{{ service.title }}" />
             </div>
           {% endif %}
            {{ service.long_description|safe|striptags|truncatewords:25 }}
          {% endif %}
        </p>

        <div class="project-meta">
          {% if service.is_featured %}
            <div class="meta-item">
              <i class="meta-icon" data-lucide="star"></i>
              <span>{% trans "Featured Service" %}</span>
            </div>
          {% endif %}
          {% if service.priority and service.priority >= 3 %}
            <div class="meta-item">
              <i class="meta-icon" data-lucide="trending-up"></i>
              <span>{% trans "High Priority" %}</span>
            </div>
          {% endif %}
          {% if service.related_projects_count %}
            <div class="meta-item">
              <i class="meta-icon" data-lucide="rocket"></i>
              <span>{{ service.related_projects_count }} {% trans "projects" %}</span>
            </div>
          {% endif %}
        </div>

        <div class="project-hero-actions">
          <button class="hero-cta-button primary" onclick="window.ctaModal && window.ctaModal.show('service_hero', 'Послуга: {{ service.title|escapejs }}');">
            <i data-lucide="zap"></i>
            {% trans "Get This Service" %}
          </button>
          <a href="{% url 'services:services_list' %}" class="hero-cta-button secondary">
            <i data-lucide="grid-3x3"></i>
            {% trans "All Services" %}
          </a>
        </div>
      </div>
    </div>
  </section>

  {% if service.gallery_image_1 or service.gallery_image_2 or service.gallery_image_3 or service.gallery_image_4 %}
    <section class="project-featured-image">
      <div class="container">
        <div class="service-gallery-grid">
          {% if service.gallery_image_1 %}
            <div class="gallery-item" onclick="openLightbox('{{ service.gallery_image_1.url }}')">
              <img src="{{ service.gallery_image_1.url }}" alt="Service Gallery 1" loading="lazy">
              <div class="gallery-overlay">
                <i data-lucide="zoom-in"></i>
              </div>
            </div>
          {% endif %}
          {% if service.gallery_image_2 %}
            <div class="gallery-item" onclick="openLightbox('{{ service.gallery_image_2.url }}')">
              <img src="{{ service.gallery_image_2.url }}" alt="Service Gallery 2" loading="lazy">
              <div class="gallery-overlay">
                <i data-lucide="zoom-in"></i>
              </div>
            </div>
          {% endif %}
          {% if service.gallery_image_3 %}
            <div class="gallery-item" onclick="openLightbox('{{ service.gallery_image_3.url }}')">
              <img src="{{ service.gallery_image_3.url }}" alt="Service Gallery 3" loading="lazy">
              <div class="gallery-overlay">
                <i data-lucide="zoom-in"></i>
              </div>
            </div>
          {% endif %}
          {% if service.gallery_image_4 %}
            <div class="gallery-item" onclick="openLightbox('{{ service.gallery_image_4.url }}')">
              <img src="{{ service.gallery_image_4.url }}" alt="Service Gallery 4" loading="lazy">
              <div class="gallery-overlay">
                <i data-lucide="zoom-in"></i>
              </div>
            </div>
          {% endif %}
        </div>
      </div>
    </section>
  {% endif %}

  <section class="project-main-content">
    <div class="container">
      <div class="content-grid">
        
        <div class="main-content-column">
          
          <div class="content-section">
            <div class="content-section-header">
              <div class="section-icon">
                <i data-lucide="file-text"></i>
              </div>
              <h2>{% trans "Service Overview" %}</h2>
            </div>
            <div class="content-section-body">
              {{ service.long_description|safe }}
            </div>
          </div>

          {% if service.audience %}
          <div class="content-section">
            <div class="content-section-header">
              <div class="section-icon">
                <i data-lucide="users"></i>
              </div>
              <h2>{% trans "Target Audience" %}</h2>
            </div>
            <div class="content-section-body">
              {{ service.audience|safe }}
            </div>
          </div>
          {% endif %}

          {% if cross_promotion_content %}
          <div class="sidebar-section">
            <h3>
              <i data-lucide="sparkles"></i>
              {% trans "You Might Also Like" %}
            </h3>
            <div class="related-content-list">
              {% for item in cross_promotion_content|slice:":3" %}
                <a href="{{ item.url }}" class="related-item">
                  {% if item.image %}
                    <div class="related-image">
                      <img src="{{ item.image }}" alt="{{ item.title }}" loading="lazy">
                    </div>
                  {% endif %}
                  <div class="related-content">
                    <h4>{{ item.title|safe|truncatewords:10 }}</h4>
                    <div class="related-meta">
                      <span class="related-category">
                        {% if item.type == 'article' %}{% trans "Article" %}
                        {% elif item.type == 'project' %}{% trans "Project" %}
                        {% else %}{% trans "Service" %}{% endif %}
                      </span>
                    </div>
                  </div>
                </a>
              {% endfor %}
            </div>
          </div>
          {% endif %}

          

          {% if service.value %}
          <div class="content-section">
            <div class="content-section-header">
              <div class="section-icon">
                <i data-lucide="trending-up"></i>
              </div>
              <h2>{% trans "Business Value" %}</h2>
            </div>
            <div class="content-section-body">
              {{ service.value|safe }}
            </div>
          </div>
          {% endif %}

          {% if service.pricing %}
          <div class="content-section">
            <div class="content-section-header">
              <div class="section-icon">
                <i data-lucide="dollar-sign"></i>
              </div>
              <h2>{% trans "Pricing" %}</h2>
            </div>
            <div class="content-section-body">
              {{ service.pricing|safe }}
            </div>
          </div>
          {% endif %}

        </div>

        <div class="project-sidebar">
          
          <div class="sidebar-section cta-sidebar">
            <h3>
              <i data-lucide="message-circle"></i>
              {% trans "Quick Contact" %}
            </h3>
            <p class="cta-description">
              {% trans "Ready to implement this service? Let's discuss your specific needs and create a custom solution." %}
            </p>
            <button class="sidebar-cta-button" onclick="window.ctaModal && window.ctaModal.show('service_sidebar', 'Послуга: {{ service.title|escapejs }}');">
              <i data-lucide="send"></i>
              {% trans "Start Discussion" %}
            </button>
          </div>

          <div class="sidebar-section">
            <h3>
              <i data-lucide="info"></i>
              {% trans "Service Details" %}
            </h3>
            <div class="project-info-list">
              {% if service.priority %}
                <div class="info-item">
                  <span class="info-label">{% trans "Priority" %}</span>
                  <span class="info-value">
                    {{ service.priority_emoji }}
                    {% if service.priority == 5 %}{% trans "Top Service" %}
                    {% elif service.priority == 4 %}{% trans "Critical" %}
                    {% elif service.priority == 3 %}{% trans "High" %}
                    {% elif service.priority == 2 %}{% trans "Normal" %}
                    {% else %}{% trans "Low" %}{% endif %}
                  </span>
                </div>
              {% endif %}
              
              {% if service.is_featured %}
                <div class="info-item">
                  <span class="info-label">{% trans "Status" %}</span>
                  <span class="info-value">⭐ {% trans "Featured" %}</span>
                </div>
              {% endif %}
              
              {% if service.date_created %}
                <div class="info-item">
                  <span class="info-label">{% trans "Available Since" %}</span>
                  <span class="info-value">{{ service.date_created|date:"M Y" }}</span>
                </div>
              {% endif %}
            </div>
          </div>

          

          {% if related_articles %}
          <div class="sidebar-section">
            <h3>
              <i data-lucide="newspaper"></i>
              {% trans "Related News" %}
            </h3>
            <div class="related-content-list">
              {% for article in related_articles|slice:":3" %}
                <a href="{{ article.url }}" class="related-item">
                  {% if article.ai_image_url %}
                    <div class="related-image">
                      <img src="{{ article.ai_image_url }}" alt="{{ article.title }}" loading="lazy">
                    </div>
                  {% endif %}
                  <div class="related-content">
                    <h4>{{ article.title|safe|truncatewords:8 }}</h4>
                    <div class="related-meta">
                      {% if article.published_at %}
                        <span>{{ article.published_at|date:"M d" }}</span>
                      {% endif %}
                      {% if article.source_domain %}
                        <span class="related-category">{{ article.source_domain }}</span>
                      {% endif %}
                    </div>
                  </div>
                </a>
              {% endfor %}
            </div>
          </div>
          {% endif %}

        </div>
        </div>
    </div>
  </section>

  

  {% if service.video_url or service.video_file %}
    <section class="project-video-section">
      <div class="container">
        <header class="video-header">
          <h2>{% trans "Service Demonstration" %}</h2>
        </header>
        
        <div class="video-container glass">
          {% if service.video_url %}
            <iframe src="{{ service.video_url }}" frameborder="0" allowfullscreen></iframe>
          {% elif service.video_file %}
            <video controls>
              <source src="{{ service.video_file.url }}" type="video/mp4">
            </video>
          {% endif %}
        </div>
      </div>
    </section>
  {% endif %}

  

  {% include 'includes/social_share.html' with share_title=service.title %}

  <section class="project-contact-cta">
    <div class="container">
      <div class="contact-cta-card glass card">
        <div class="cta-content">
          <h2>{% trans "Ready to Get Started?" %}</h2>
          <p class="cta-description">
            {% trans "Let's discuss how this service can transform your business. Get a free consultation and custom solution proposal." %}
          </p>
          <div class="cta-actions">
            <button class="btn-primary hero-cta-button primary" 
                    data-service-title="{{ service.title|escapejs }}"
                    onclick="window.ctaModal && window.ctaModal.show('service_detail', 'Консультація: ' + this.dataset.serviceTitle);">
              <i data-lucide="message-circle"></i>
              {% trans "Start Free Consultation" %}
            </button>
            <a href="{% url 'services:services_list' %}" class="btn-secondary hero-cta-button secondary">
              <i data-lucide="grid-3x3"></i>
              {% trans "Browse All Services" %}
            </a>
          </div>
        </div>
      </div>
    </div>
  </section>

</article>

<div id="lightbox" class="lightbox" onclick="closeLightbox()">
  <div class="lightbox-content">
    <img id="lightbox-image" src="" alt="">
    <button class="lightbox-close" onclick="closeLightbox()">
      <i data-lucide="x"></i>
    </button>
  </div>
</div>

{% endblock %}

{% block extra_scripts %}
<script>
function openLightbox(imageSrc) {
  const lightbox = document.getElementById('lightbox');
  const lightboxImage = document.getElementById('lightbox-image');
  lightboxImage.src = imageSrc;
  lightbox.style.display = 'flex';
  document.body.style.overflow = 'hidden';
}

function closeLightbox() {
  const lightbox = document.getElementById('lightbox');
  lightbox.style.display = 'none';
  document.body.style.overflow = 'auto';
}

function scrollToContact(serviceTitle) {
  window.location.href = `/${document.body.getAttribute('data-current-lang') || 'uk'}/#contact`;
  
  setTimeout(() => {
    const messageField = document.querySelector('textarea[name="message"], input[name="message"]');
    if (messageField && serviceTitle) {
      const currentLang = document.documentElement.lang || 'uk';
      const messages = {
        'uk': `Привіт! Мене цікавить послуга "${serviceTitle}". Хочу обговорити можливості співпраці.`,
        'en': `Hi! I'm interested in the "${serviceTitle}" service. I'd like to discuss collaboration opportunities.`,
        'pl': `Cześć! Interesuje mnie usługa "${serviceTitle}". Chciałbym omówić możliwości współpracy.`
      };
      messageField.value = messages[currentLang] || messages['uk'];
      messageField.focus();
    }
  }, 1000);
}

document.addEventListener('DOMContentLoaded', function() {
  if (typeof lucide !== 'undefined') {
    lucide.createIcons();
  }

  document.querySelectorAll('.service-tag-pill[style*="border-color"], .tag-chip[style*="--tag-color"]').forEach(function(tag) {
  });

  document.querySelectorAll('.clickable').forEach(function (card) {
    card.addEventListener('click', function (e) {
      if (e.target.closest('a, button')) return;
      
      const href = card.getAttribute('data-href');
      if (href) window.location.href = href;
    });
  });
  
  const expandTriggers = document.querySelectorAll('.expand-trigger');
  expandTriggers.forEach(trigger => {
    trigger.addEventListener('click', function() {
      const chevron = this.querySelector('[data-lucide="chevron-down"]');
      if (chevron) {
        setTimeout(() => {
          const isOpen = this.parentElement.hasAttribute('open');
          chevron.style.transform = isOpen ? 'rotate(180deg)' : 'rotate(0deg)';
        }, 10);
      }
    });
  });
});

document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') {
    closeLightbox();
  }
});
</script>
{% endblock %}