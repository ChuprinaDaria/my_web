{% extends "core/base.html" %}
{% load static i18n %}
{% get_current_language as CURRENT_LANG %}

<!-- SEO BLOCKS -->
{% block title %}{{ service.seo_title|default:service.title }} | Lazysoft{% endblock %}
{% block meta_description %}{{ service.seo_description|default:service.short|striptags|truncatewords:25 }}{% endblock %}
{% block og_title %}{{ service.title|striptags }}{% endblock %}
{% block og_description %}{{ service.short|striptags|truncatewords:30 }}{% endblock %}
{% block og_image %}{% if service.icon %}https://lazysoft.dev{{ service.icon.url }}{% else %}https://lazysoft.dev{% static 'images/services-og.jpg' %}{% endif %}{% endblock %}

{% block extra_meta %}
  <link rel="canonical" href="https://lazysoft.dev/{{ CURRENT_LANG }}/services/{{ service.slug }}/" />
  
  <link rel="alternate" href="https://lazysoft.dev/en/services/{{ service.slug }}/" hreflang="en">
  <link rel="alternate" href="https://lazysoft.dev/uk/services/{{ service.slug }}/" hreflang="uk">
  <link rel="alternate" href="https://lazysoft.dev/pl/services/{{ service.slug }}/" hreflang="pl">
  
  <!-- Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Service",
    "name": "{{ service.title|escapejs }}",
    "description": "{{ service.short|striptags|escapejs }}",
    "provider": {
      "@type": "Organization",
      "name": "Lazysoft",
      "url": "https://lazysoft.dev"
    },
    "areaServed": "Worldwide",
    {% if service.icon %}"image": "https://lazysoft.dev{{ service.icon.url }}",{% endif %}
    "url": "https://lazysoft.dev/{{ CURRENT_LANG }}/services/{{ service.slug }}/"
  }
  </script>
{% endblock %}

<!-- CONTENT -->
{% block content %}
<article class="service-detail-container">
  
  <!-- üéØ Hero Section - –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∑ project_detail -->
  <section class="service-hero-section">
    <div class="container">
      <div class="hero-content">
        
        <!-- üè∑Ô∏è Service Tags Header - –ù–û–í–ê —Å–∏—Å—Ç–µ–º–∞ —Ç–µ–≥—ñ–≤ -->
        {% if service.tags.all %}
          <div class="service-tags-header">
            {% for tag in service.tags.all|slice:":4" %}
              <a href="/{{ CURRENT_LANG }}/services/tag/{{ tag.slug }}/" 
                 class="service-tag-pill"
                 {% if tag.color %}style="border-color: {{ tag.color }}; color: {{ tag.color }};"{% endif %}>
                {% if tag.icon %}{{ tag.icon }}{% else %}üè∑Ô∏è{% endif %}
                {% if CURRENT_LANG == 'uk' and tag.name_uk %}{{ tag.name_uk }}
                {% elif CURRENT_LANG == 'pl' and tag.name_pl %}{{ tag.name_pl }}
                {% else %}{{ tag.name_en }}{% endif %}
              </a>
            {% endfor %}
          </div>
        {% endif %}

        <!-- Service Icon + Title -->
        <div class="service-hero-header">
          {% if service.icon %}
            <div class="service-hero-icon">
              <img src="{{ service.icon.url }}" alt="{{ service.title }}" />
            </div>
          {% endif %}
        </div>

        <h1>{{ service.title|safe }}</h1>
        
        <p>
          {% if service.short %}
            {{ service.short|safe|striptags|truncatewords:35 }}
          {% else %}
            {{ service.long_description|safe|striptags|truncatewords:25 }}
          {% endif %}
        </p>

        <!-- üìä Service Meta - —è–∫ –≤ project_detail -->
        <div class="project-meta">
          {% if service.is_featured %}
            <div class="meta-item">
              <i class="meta-icon" data-lucide="star"></i>
              <span>{% trans "Featured Service" %}</span>
            </div>
          {% endif %}
          {% if service.priority and service.priority >= 3 %}
            <div class="meta-item">
              <i class="meta-icon" data-lucide="trending-up"></i>
              <span>{% trans "High Priority" %}</span>
            </div>
          {% endif %}
          {% if service.related_projects_count %}
            <div class="meta-item">
              <i class="meta-icon" data-lucide="rocket"></i>
              <span>{{ service.related_projects_count }} {% trans "projects" %}</span>
            </div>
          {% endif %}
        </div>

        <!-- üöÄ Hero Actions -->
        <div class="project-hero-actions">
          <button class="hero-cta-button primary" onclick="window.ctaModal && window.ctaModal.show('service_hero', '–ü–æ—Å–ª—É–≥–∞: {{ service.title|escapejs }}');">
            <i data-lucide="zap"></i>
            {% trans "Get This Service" %}
          </button>
          <a href="{% url 'services:services_list' %}" class="hero-cta-button secondary">
            <i data-lucide="grid-3x3"></i>
            {% trans "All Services" %}
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- üñºÔ∏è Service Gallery - —è–∫—â–æ —î –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è -->
  {% if service.gallery_image_1 or service.gallery_image_2 or service.gallery_image_3 or service.gallery_image_4 %}
    <section class="project-featured-image">
      <div class="container">
        <div class="service-gallery-grid">
          {% if service.gallery_image_1 %}
            <div class="gallery-item" onclick="openLightbox('{{ service.gallery_image_1.url }}')">
              <img src="{{ service.gallery_image_1.url }}" alt="Service Gallery 1" loading="lazy">
              <div class="gallery-overlay">
                <i data-lucide="zoom-in"></i>
              </div>
            </div>
          {% endif %}
          {% if service.gallery_image_2 %}
            <div class="gallery-item" onclick="openLightbox('{{ service.gallery_image_2.url }}')">
              <img src="{{ service.gallery_image_2.url }}" alt="Service Gallery 2" loading="lazy">
              <div class="gallery-overlay">
                <i data-lucide="zoom-in"></i>
              </div>
            </div>
          {% endif %}
          {% if service.gallery_image_3 %}
            <div class="gallery-item" onclick="openLightbox('{{ service.gallery_image_3.url }}')">
              <img src="{{ service.gallery_image_3.url }}" alt="Service Gallery 3" loading="lazy">
              <div class="gallery-overlay">
                <i data-lucide="zoom-in"></i>
              </div>
            </div>
          {% endif %}
          {% if service.gallery_image_4 %}
            <div class="gallery-item" onclick="openLightbox('{{ service.gallery_image_4.url }}')">
              <img src="{{ service.gallery_image_4.url }}" alt="Service Gallery 4" loading="lazy">
              <div class="gallery-overlay">
                <i data-lucide="zoom-in"></i>
              </div>
            </div>
          {% endif %}
        </div>
      </div>
    </section>
  {% endif %}

  <!-- üìã Main Content Layout -->
  <section class="project-main-content">
    <div class="container">
      <div class="content-grid">
        
        <!-- üìÑ Main Content Column -->
        <div class="main-content-column">
          
          <!-- Service Description -->
          <div class="content-section">
            <div class="content-section-header">
              <div class="section-icon">
                <i data-lucide="file-text"></i>
              </div>
              <h2>{% trans "Service Overview" %}</h2>
            </div>
            <div class="content-section-body">
              {{ service.long_description|safe }}
            </div>
          </div>

          <!-- Target Audience -->
          {% if service.audience %}
          <div class="content-section">
            <div class="content-section-header">
              <div class="section-icon">
                <i data-lucide="users"></i>
              </div>
              <h2>{% trans "Target Audience" %}</h2>
            </div>
            <div class="content-section-body">
              {{ service.audience|safe }}
            </div>
          </div>
          {% endif %}

          <!-- Value Proposition -->
          {% if service.value %}
          <div class="content-section">
            <div class="content-section-header">
              <div class="section-icon">
                <i data-lucide="trending-up"></i>
              </div>
              <h2>{% trans "Business Value" %}</h2>
            </div>
            <div class="content-section-body">
              {{ service.value|safe }}
            </div>
          </div>
          {% endif %}

          <!-- Pricing Information -->
          {% if service.pricing %}
          <div class="content-section">
            <div class="content-section-header">
              <div class="section-icon">
                <i data-lucide="dollar-sign"></i>
              </div>
              <h2>{% trans "Pricing" %}</h2>
            </div>
            <div class="content-section-body">
              {{ service.pricing|safe }}
            </div>
          </div>
          {% endif %}

        </div>

        <!-- üìä Sidebar -->
        <div class="project-sidebar">
          
          <!-- üéØ Quick Contact CTA -->
          <div class="sidebar-section cta-sidebar">
            <h3>
              <i data-lucide="message-circle"></i>
              {% trans "Quick Contact" %}
            </h3>
            <p class="cta-description">
              {% trans "Ready to implement this service? Let's discuss your specific needs and create a custom solution." %}
            </p>
            <button class="sidebar-cta-button" onclick="window.ctaModal && window.ctaModal.show('service_sidebar', '–ü–æ—Å–ª—É–≥–∞: {{ service.title|escapejs }}');">
              <i data-lucide="send"></i>
              {% trans "Start Discussion" %}
            </button>
          </div>

          <!-- üìä Service Info -->
          <div class="sidebar-section">
            <h3>
              <i data-lucide="info"></i>
              {% trans "Service Details" %}
            </h3>
            <div class="project-info-list">
              {% if service.priority %}
                <div class="info-item">
                  <span class="info-label">{% trans "Priority" %}</span>
                  <span class="info-value">
                    {{ service.priority_emoji }}
                    {% if service.priority == 5 %}{% trans "Top Service" %}
                    {% elif service.priority == 4 %}{% trans "Critical" %}
                    {% elif service.priority == 3 %}{% trans "High" %}
                    {% elif service.priority == 2 %}{% trans "Normal" %}
                    {% else %}{% trans "Low" %}{% endif %}
                  </span>
                </div>
              {% endif %}
              
              {% if service.is_featured %}
                <div class="info-item">
                  <span class="info-label">{% trans "Status" %}</span>
                  <span class="info-value">‚≠ê {% trans "Featured" %}</span>
                </div>
              {% endif %}
              
              {% if service.date_created %}
                <div class="info-item">
                  <span class="info-label">{% trans "Available Since" %}</span>
                  <span class="info-value">{{ service.date_created|date:"M Y" }}</span>
                </div>
              {% endif %}
            </div>
          </div>

          <!-- üè∑Ô∏è Service Tags -->
          {% if service.tags.all %}
          <div class="sidebar-section">
            <h3>
              <i data-lucide="tag"></i>
              {% trans "Service Tags" %}
            </h3>
            <div class="project-tags">
              {% for tag in service.tags.all %}
                <a href="/{{ CURRENT_LANG }}/services/tag/{{ tag.slug }}/" 
                   class="tag-chip"
                   {% if tag.color %}style="--tag-color: {{ tag.color }};"{% endif %}>
                  {% if tag.icon %}<span class="tag-icon">{{ tag.icon }}</span>{% endif %}
                  <span class="tag-name">
                    {% if CURRENT_LANG == 'uk' and tag.name_uk %}{{ tag.name_uk }}
                    {% elif CURRENT_LANG == 'pl' and tag.name_pl %}{{ tag.name_pl }}
                    {% else %}{{ tag.name_en }}{% endif %}
                  </span>
                </a>
              {% endfor %}
            </div>
          </div>
          {% endif %}

          <!-- üîó Related Articles - –ù–û–í–ê –∫—Ä–æ—Å-–ø—Ä–æ–º–æ—Ü—ñ—è -->
          {% if related_articles %}
          <div class="sidebar-section">
            <h3>
              <i data-lucide="newspaper"></i>
              {% trans "Related News" %}
            </h3>
            <div class="related-content-list">
              {% for article in related_articles|slice:":3" %}
                <a href="{{ article.url }}" class="related-item">
                  {% if article.ai_image_url %}
                    <div class="related-image">
                      <img src="{{ article.ai_image_url }}" alt="{{ article.title }}" loading="lazy">
                    </div>
                  {% endif %}
                  <div class="related-content">
                    <h4>{{ article.title|safe|truncatewords:8 }}</h4>
                    <div class="related-meta">
                      {% if article.published_at %}
                        <span>{{ article.published_at|date:"M d" }}</span>
                      {% endif %}
                      {% if article.source_domain %}
                        <span class="related-category">{{ article.source_domain }}</span>
                      {% endif %}
                    </div>
                  </div>
                </a>
              {% endfor %}
            </div>
          </div>
          {% endif %}

        </div>
        
      </div>
    </div>
  </section>

  <!-- üöÄ Related Projects - –ù–û–í–ê –∫—Ä–æ—Å-–ø—Ä–æ–º–æ—Ü—ñ—è -->
  {% if related_projects %}
  <section class="related-projects-section">
    <div class="container">
      <header class="related-header">
        <h2>
          <i data-lucide="rocket"></i>
          {% trans "Related Projects" %}
        </h2>
        <p>{% trans "See how we've successfully implemented this service for other clients" %}</p>
      </header>
      
      <div class="related-projects-grid">
        {% for project in related_projects %}
          <div class="related-project-card clickable" data-href="/{{ CURRENT_LANG }}/projects/{{ project.slug }}/">
            {% if project.featured_image %}
              <div class="project-image">
                <img src="{{ project.featured_image.url }}" alt="{{ project.title }}" loading="lazy">
                <div class="image-overlay-gradient"></div>
              </div>
            {% endif %}
            <div class="project-content">
              <h3>{{ project.title|safe }}</h3>
              <p class="project-description">{{ project.short_description|safe|striptags|truncatewords:15 }}</p>
              
              <!-- Project Badges -->
              {% if project.all_badges %}
                <div class="project-badges">
                  {% for badge in project.all_badges|slice:":2" %}
                    <span class="project-badge" 
                          {% if badge.color %}style="background-color: {{ badge.color }}20; border-color: {{ badge.color }}50;"{% endif %}>
                      {% if badge.icon %}{{ badge.icon }}{% endif %}
                      {{ badge.text }}
                    </span>
                  {% endfor %}
                </div>
              {% endif %}
              
              <div class="project-cta">
                <span>{% trans "View Project" %}</span>
                <i data-lucide="arrow-right"></i>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  </section>
  {% endif %}

  <!-- üé• Video Section -->
  {% if service.video_url or service.video_file %}
    <section class="project-video-section">
      <div class="container">
        <header class="video-header">
          <h2>{% trans "Service Demonstration" %}</h2>
        </header>
        
        <div class="video-container glass">
          {% if service.video_url %}
            <iframe src="{{ service.video_url }}" frameborder="0" allowfullscreen></iframe>
          {% elif service.video_file %}
            <video controls>
              <source src="{{ service.video_file.url }}" type="video/mp4">
            </video>
          {% endif %}
        </div>
      </div>
    </section>
  {% endif %}

  <!-- üîó Cross-Promotion Content - –ù–û–í–ê —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å -->
  {% if cross_promotion_content %}
  <section class="related-services-section">
    <div class="container">
      <header class="related-header">
        <h2>{% trans "You Might Also Like" %}</h2>
        <p>{% trans "Discover related services, projects, and insights" %}</p>
      </header>
      
      <div class="cross-promotion-grid">
        {% for item in cross_promotion_content %}
          <div class="cross-promotion-item {{ item.type }}-item">
            <a href="{{ item.url }}" class="cross-promotion-link">
              {% if item.image %}
                <div class="cross-promotion-image">
                  <img src="{{ item.image }}" alt="{{ item.title }}" loading="lazy">
                </div>
              {% endif %}
              <div class="cross-promotion-content">
                <div class="cross-promotion-type">
                  {% if item.type == 'article' %}üì∞ {% trans "Article" %}
                  {% elif item.type == 'project' %}üöÄ {% trans "Project" %}
                  {% elif item.type == 'service' %}üõ†Ô∏è {% trans "Service" %}
                  {% endif %}
                </div>
                <h3>{{ item.title|safe }}</h3>
                <p class="cross-promotion-summary">{{ item.summary|safe }}</p>
              </div>
            </a>
          </div>
        {% endfor %}
      </div>
    </div>
  </section>
  {% endif %}

  <!-- üì§ Social Share -->
  {% include 'includes/social_share.html' with share_title=service.title %}

  <!-- üìû Contact CTA -->
  <section class="project-contact-cta">
    <div class="container">
      <div class="contact-cta-card glass card">
        <div class="cta-content">
          <h2>{% trans "Ready to Get Started?" %}</h2>
          <p class="cta-description">
            {% trans "Let's discuss how this service can transform your business. Get a free consultation and custom solution proposal." %}
          </p>
          <div class="cta-actions">
            <button class="btn-primary hero-cta-button primary" 
                    data-service-title="{{ service.title|escapejs }}"
                    onclick="window.ctaModal && window.ctaModal.show('service_detail', '–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—è: ' + this.dataset.serviceTitle);">
              <i data-lucide="message-circle"></i>
              {% trans "Start Free Consultation" %}
            </button>
            <a href="{% url 'services:services_list' %}" class="btn-secondary hero-cta-button secondary">
              <i data-lucide="grid-3x3"></i>
              {% trans "Browse All Services" %}
            </a>
          </div>
        </div>
      </div>
    </div>
  </section>

</article>

<!-- üîç Lightbox Modal -->
<div id="lightbox" class="lightbox" onclick="closeLightbox()">
  <div class="lightbox-content">
    <img id="lightbox-image" src="" alt="">
    <button class="lightbox-close" onclick="closeLightbox()">
      <i data-lucide="x"></i>
    </button>
  </div>
</div>

{% endblock %}

{% block extra_scripts %}
<script>
// üîç Lightbox functionality
function openLightbox(imageSrc) {
  const lightbox = document.getElementById('lightbox');
  const lightboxImage = document.getElementById('lightbox-image');
  lightboxImage.src = imageSrc;
  lightbox.style.display = 'flex';
  document.body.style.overflow = 'hidden';
}

function closeLightbox() {
  const lightbox = document.getElementById('lightbox');
  lightbox.style.display = 'none';
  document.body.style.overflow = 'auto';
}

// üìû Scroll to contact
function scrollToContact(serviceTitle) {
  // Scroll to contact form (assuming it's on the same page or redirect)
  window.location.href = `/${document.body.getAttribute('data-current-lang') || 'uk'}/#contact`;
  
  // Pre-fill message if contact form exists
  setTimeout(() => {
    const messageField = document.querySelector('textarea[name="message"], input[name="message"]');
    if (messageField && serviceTitle) {
      const currentLang = document.documentElement.lang || 'uk';
      const messages = {
        'uk': `–ü—Ä–∏–≤—ñ—Ç! –ú–µ–Ω–µ —Ü—ñ–∫–∞–≤–∏—Ç—å –ø–æ—Å–ª—É–≥–∞ "${serviceTitle}". –•–æ—á—É –æ–±–≥–æ–≤–æ—Ä–∏—Ç–∏ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ —Å–ø—ñ–≤–ø—Ä–∞—Ü—ñ.`,
        'en': `Hi! I'm interested in the "${serviceTitle}" service. I'd like to discuss collaboration opportunities.`,
        'pl': `Cze≈õƒá! Interesuje mnie us≈Çuga "${serviceTitle}". Chcia≈Çbym om√≥wiƒá mo≈ºliwo≈õci wsp√≥≈Çpracy.`
      };
      messageField.value = messages[currentLang] || messages['uk'];
      messageField.focus();
    }
  }, 1000);
}

document.addEventListener('DOMContentLoaded', function() {
  // Initialize Lucide icons
  if (typeof lucide !== 'undefined') {
    lucide.createIcons();
  }

  // Set tag colors dynamically
  document.querySelectorAll('.service-tag-pill[style*="border-color"], .tag-chip[style*="--tag-color"]').forEach(function(tag) {
    // Colors are already set in the template via style attributes
  });

  // Clickable cards functionality
  document.querySelectorAll('.clickable').forEach(function (card) {
    card.addEventListener('click', function (e) {
      // Don't trigger if clicking on a link or button
      if (e.target.closest('a, button')) return;
      
      const href = card.getAttribute('data-href');
      if (href) window.location.href = href;
    });
  });
  
  // Enhanced expandable content (if needed later)
  const expandTriggers = document.querySelectorAll('.expand-trigger');
  expandTriggers.forEach(trigger => {
    trigger.addEventListener('click', function() {
      const chevron = this.querySelector('[data-lucide="chevron-down"]');
      if (chevron) {
        setTimeout(() => {
          const isOpen = this.parentElement.hasAttribute('open');
          chevron.style.transform = isOpen ? 'rotate(180deg)' : 'rotate(0deg)';
        }, 10);
      }
    });
  });
});

// ‚å®Ô∏è Keyboard navigation for lightbox
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') {
    closeLightbox();
  }
});
</script>
{% endblock %}