{% extends "core/base.html" %}
{% load static i18n %}
{% get_current_language as CURRENT_LANG %}

{% block title %}{{ seo_title }}{% endblock %}
{% block meta_description %}{{ seo_description }}{% endblock %}
{% block og_title %}{{ seo_title }}{% endblock %}
{% block og_description %}{{ seo_description }}{% endblock %}
{% block og_image %}{% static 'images/projects-og.jpg' %}{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/sections/projects.css' %}">
  <link rel="stylesheet" href="{% static 'css/components/projects_carousel.css' %}">
  <link rel="stylesheet" href="{% static 'css/components/project_card_home.css' %}">
  <link rel="stylesheet" href="{% static 'css/sections/projects_sidebar.css' %}">
{% endblock %}

{% block extra_meta %}
  <link rel="canonical" href="https://lazysoft.dev/{{ CURRENT_LANG }}/projects/" />
  <link rel="alternate" href="https://lazysoft.dev/en/projects/" hreflang="en">
  <link rel="alternate" href="https://lazysoft.dev/uk/projects/" hreflang="uk">
  <link rel="alternate" href="https://lazysoft.dev/pl/projects/" hreflang="pl">
{% endblock %}

{% block content %}
<main class="projects-page">

  <section class="hero projects-hero">
    <div class="container">
      <div class="hero-content">
        <h1>{{ overview_title|safe }}</h1>
        <p class="description">{{ overview_description|safe }}</p>
        
        <div class="projects-stats">
          <div class="stat-item">
            <span class="stat-number">{{ total_categories }}+</span>
            <span class="stat-label">{% trans "Solutions" %}</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">{{ total_projects }}+</span>
            <span class="stat-label">{% trans "Projects" %}</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">100%</span>
            <span class="stat-label">{% trans "Success Rate" %}</span>
          </div>
        </div>

        {% if show_tag_filter and popular_tags %}
        <div class="tags-filter-section">
          <h3 class="tags-filter-title">{% trans "Filter by Technology" %}</h3>
          <div class="tags-filter">
            <a href="{% url 'projects' %}" class="tag-filter-item active">
              <span class="tag-emoji">üè¢</span>
              <span class="tag-name">{% trans "All Projects" %}</span>
              <span class="tag-count">{{ total_projects }}</span>
            </a>
            {% for tag in popular_tags %}
            <a href="{% url 'projects_by_tag' tag.key %}" class="tag-filter-item">
              <span class="tag-emoji">{{ tag.emoji }}</span>
              <span class="tag-name">{{ tag.name }}</span>
              <span class="tag-count">{{ tag.projects_count }}</span>
            </a>
            {% endfor %}
          </div>
        </div>
        {% endif %}

        <div class="hero-cta">
          <a href="#contact" class="btn-primary">
            <i data-lucide="rocket"></i>
            {% trans "Start Your Project" %}
          </a>
        </div>
      </div>
    </div>
  </section>

  {% if featured_projects_qs %}
    <section class="featured-projects-section">
      <div class="container-reg">
        {% include 'includes/projects_carousel.html' with title=_('Featured Projects') projects=featured_projects_qs show_navigation=True carousel_id='featured-projects' %}
      </div>
    </section>
  {% endif %}

  <section class="projects-main-section">
    <div class="container">
      <div class="projects-layout">
        
        <div class="projects-content">
          
          <div class="projects-categories-section">
            {% for category in categories %}
              <div class="category-section">
                
                <div class="category-header glass card">
                  <div class="category-info">
                    <div class="category-icon">
                      {% if category.icon %}
                        <img src="{{ category.icon.url }}" alt="{{ category.title }}">
                      {% else %}
                        <span class="default-icon">üè¢</span>
                      {% endif %}
                    </div>
                    <div class="category-text">
                      <h2 class="category-title">{{ category.title|safe }}</h2>
                      <p class="category-description">{{ category.short_description|safe|truncatewords:25 }}</p>
                    </div>
                  </div>
                  
                  <div class="category-actions">
                    <div class="category-stats">
                      <span class="stat-number">{{ category.projects_count }}</span>
                      <span class="stat-label">{% trans "projects" %}</span>
                    </div>
                    <a href="{{ category.service_url }}" class="btn-secondary category-service-btn">
                      <i data-lucide="arrow-right"></i>
                      {% trans "Learn More About Service" %}
                    </a>
                  </div>
                </div>

                <div class="projects-grid">
                  {% for project in category.projects %}
                    {% include 'includes/project_card.html' with project=project %}
                  {% endfor %}
                </div>

                <div class="category-bottom-cta">
                  <div class="glass card">
                    <div class="cta-content">
                      <h3>{% trans "Need Similar Solution?" %}</h3>
                      <p>
                        {% blocktrans with service_name=category.title %}
                        Interested in {{ service_name }}? Let's discuss your specific needs and create a custom solution.
                        {% endblocktrans %}
                      </p>
                      <div class="cta-actions">
                        <button class="btn-primary" onclick="scrollToContact('{{ category.title|escapejs }}');">
                          <i data-lucide="message-circle"></i>
                          {% trans "Get Quote" %}
                        </button>
                        <a href="{{ category.service_url }}" class="btn-secondary">
                          <i data-lucide="info"></i>
                          {% trans "Service Details" %}
                        </a>
                      </div>
                    </div>
                  </div>
                </div>

              </div>
            {% endfor %}
          </div>

        </div>

        <aside class="projects-sidebar">
          
          {% if related_news %}
            <div class="sidebar-section glass card">
              <h3 class="sidebar-title">
                <i data-lucide="newspaper"></i>
                {% trans "Related Tech News" %}
              </h3>
              <div class="related-news-list">
                {% for article in related_news %}
                  <a href="{{ article.url }}" class="news-item" target="_blank">
                    <div class="news-content">
                      <h4 class="news-title">{{ article.title|truncatewords:10 }}</h4>
                      <p class="news-summary">{{ article.summary }}</p>
                      <div class="news-meta">
                        {% if article.category %}
                          <span class="news-category">{{ article.category }}</span>
                        {% endif %}
                        <time class="news-date">{{ article.published_at|date:"j.m" }}</time>
                      </div>
                    </div>
                    {% if article.image %}
                      <div class="news-image">
                        <img src="{{ article.image }}" alt="{{ article.title }}" loading="lazy">
                      </div>
                    {% endif %}
                  </a>
                {% endfor %}
              </div>
              <a href="/{{ CURRENT_LANG }}/news/" class="sidebar-cta-link">
                <i data-lucide="external-link"></i>
                {% trans "View All Tech News" %}
              </a>
            </div>
          {% endif %}

          {% if popular_tags %}
            <div class="sidebar-section glass card">
              <h3 class="sidebar-title">
                <i data-lucide="code"></i>
                {% trans "Popular Technologies" %}
              </h3>
              <div class="tech-tags-list">
                {% for tag in popular_tags %}
                  <a href="{% url 'projects_by_tag' tag.key %}" class="tech-tag-item">
                    <span class="tag-emoji">{{ tag.emoji }}</span>
                    <span class="tag-info">
                      <span class="tag-name">{{ tag.name }}</span>
                      <small class="tag-stats">{{ tag.projects_count }} project{{ tag.projects_count|pluralize }}</small>
                    </span>
                  </a>
                {% endfor %}
              </div>
            </div>
          {% endif %}

          <div class="sidebar-section glass card cta-sidebar">
            <h3 class="sidebar-title">
              <i data-lucide="sparkles"></i>
              {% trans "Start Your Project" %}
            </h3>
            <p class="cta-description">
              {% trans "Ready to automate your business? Let's discuss your needs and create a custom solution." %}
            </p>
            <button class="sidebar-cta-button" onclick="scrollToContact('Custom Project');">
              <i data-lucide="arrow-right"></i>
              {% trans "Get Free Consultation" %}
            </button>
          </div>

          <div class="sidebar-section glass card">
            <h3 class="sidebar-title">
              <i data-lucide="grid-3x3"></i>
              {% trans "All Our Services" %}
            </h3>
            <div class="services-overview-list">
              {% for category in categories %}
                <a href="{{ category.service_url }}" class="service-overview-item">
                  <div class="service-icon">
                    {% if category.icon %}
                      <img src="{{ category.icon.url }}" alt="{{ category.title }}">
                    {% else %}
                      <span class="default-icon">üè¢</span>
                    {% endif %}
                  </div>
                  <div class="service-info">
                    <span class="service-name">{{ category.title }}</span>
                    <small class="service-count">{{ category.projects_count }} project{{ category.projects_count|pluralize }}</small>
                  </div>
                </a>
              {% endfor %}
            </div>
            <a href="/{{ CURRENT_LANG }}/services/" class="sidebar-cta-link">
              <i data-lucide="arrow-right"></i>
              {% trans "View All Services" %}
            </a>
          </div>

        </aside>

      </div>
    </div>
  </section>

  {% include 'includes/social_share.html' %}

</main>

<section id="contact" class="contact">
  {% include "core/contact_form.html" %}
</section>

{% endblock %}

{% block extra_scripts %}
<script src="{% static 'js/projects_carousel.js' %}"></script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": "{{ seo_title|escapejs }}",
  "description": "{{ seo_description|escapejs }}",
  "url": "https://lazysoft.dev/{{ CURRENT_LANG }}/projects/",
  "inLanguage": "{{ CURRENT_LANG }}",
  "mainEntity": {
    "@type": "ItemList",
    "numberOfItems": {{ total_projects }},
    "itemListElement": [
      {% for category in categories %}
        {% for project in category.projects %}
        {
          "@type": "ListItem",
          "position": {{ forloop.parentloop.counter0|add:forloop.counter }},
          "url": "https://lazysoft.dev/{{ CURRENT_LANG }}/projects/{{ project.slug }}/",
          "name": "{{ project.title|escapejs }}"
        }{% if not forloop.last or not forloop.parentloop.last %},{% endif %}
        {% endfor %}
      {% endfor %}
    ]
  }
}
</script>

<script>
function scrollToContact(projectInfo) {
  const contactSection = document.getElementById('contact');
  if (contactSection) {
    contactSection.scrollIntoView({ 
      behavior: 'smooth',
      block: 'start'
    });
    
    setTimeout(() => {
      const messageField = document.querySelector('#contact textarea, #contact input[name="message"]');
      if (messageField && projectInfo) {
        const currentLang = document.documentElement.lang || 'uk';
        const messages = {
          'uk': `–ü—Ä–∏–≤—ñ—Ç! –ú–µ–Ω–µ –∑–∞—Ü—ñ–∫–∞–≤–∏–ª–∏ –ø—Ä–æ—î–∫—Ç–∏ –∑ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó "${projectInfo}". –•–æ—á—É –æ–±–≥–æ–≤–æ—Ä–∏—Ç–∏ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ —Å–ø—ñ–≤–ø—Ä–∞—Ü—ñ.`,
          'en': `Hi! I'm interested in projects from "${projectInfo}" category. I'd like to discuss collaboration opportunities.`,
          'pl': `Cze≈õƒá! InteresujƒÖ mnie projekty z kategorii "${projectInfo}". Chcia≈Çbym om√≥wiƒá mo≈ºliwo≈õci wsp√≥≈Çpracy.`
        };
        messageField.value = messages[currentLang] || messages['uk'];
        messageField.focus();
      }
    }, 1000);
  }
}

document.addEventListener('DOMContentLoaded', function() {
  if (typeof lucide !== 'undefined') {
    lucide.createIcons();
  }
});
</script>
{% endblock %}