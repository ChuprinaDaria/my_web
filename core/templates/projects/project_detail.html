{% extends "core/base.html" %}
{% load static i18n %}
{% get_current_language as CURRENT_LANG %}

{% block title %}
  {% if CURRENT_LANG == 'uk' and project.title_uk %}{{ project.title_uk|striptags }} | Lazysoft
  {% elif CURRENT_LANG == 'pl' and project.title_pl %}{{ project.title_pl|striptags }} | Lazysoft  
  {% else %}{{ project.title_en|striptags }} | Lazysoft{% endif %}
{% endblock %}

{% block meta_description %}
  {% if CURRENT_LANG == 'uk' and project.client_request_uk %}{{ project.client_request_uk|striptags|truncatewords:25 }}
  {% elif CURRENT_LANG == 'pl' and project.client_request_pl %}{{ project.client_request_pl|striptags|truncatewords:25 }}
  {% else %}{{ project.client_request_en|striptags|truncatewords:25 }}{% endif %}
{% endblock %}

{% block og_title %}{{ og_title|default:project.title_uk|default:project.title_en|striptags }}{% endblock %}

{% block og_description %}{{ og_description|default:project.short_description_uk|default:project.short_description_en|striptags|truncatewords:30 }}{% endblock %}

{% block og_image %}{% if og_image %}{{ og_image }}{% elif project.featured_image %}https://lazysoft.pl{{ project.featured_image.url }}{% endif %}{% endblock %}

{% block extra_meta %}
  <link rel="canonical" href="https://lazysoft.pl/{% if CURRENT_LANG != 'en' %}{{ CURRENT_LANG }}/{% endif %}projects/{{ project.slug }}/" />
  
  <link rel="alternate" href="https://lazysoft.pl/projects/{{ project.slug }}/" hreflang="en">
  <link rel="alternate" href="https://lazysoft.pl/uk/projects/{{ project.slug }}/" hreflang="uk">
  <link rel="alternate" href="https://lazysoft.pl/pl/projects/{{ project.slug }}/" hreflang="pl">
  
  <meta property="og:site_name" content="LAZYSOFT">
  <meta property="og:type" content="article">
  {% if og_image %}<meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">{% endif %}
  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="{{ og_title|default:project.title_uk|default:project.title_en|striptags }}">
  <meta name="twitter:description" content="{{ og_description|default:project.short_description_uk|default:project.short_description_en|striptags|truncatewords:30 }}">
  {% if og_image %}<meta name="twitter:image" content="{{ og_image }}">
  {% elif project.featured_image %}<meta name="twitter:image" content="https://lazysoft.pl{{ project.featured_image.url }}">{% endif %}
  
  <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
{% endblock %}

{% block content %}
<article class="project-detail-container" itemscope itemtype="https://schema.org/CreativeWork">
  <meta itemprop="inLanguage" content="{{ CURRENT_LANG }}">
  
  {% include 'includes/project_hero.html' with project=project %}

  {% if project.featured_image %}
    <section class="project-featured-image">
      <div class="container">
        <div class="featured-image-container" itemprop="image" itemscope itemtype="https://schema.org/ImageObject">
          <img src="{{ project.featured_image.url }}" 
               alt="{% if CURRENT_LANG == 'uk' and project.title_uk %}{{ project.title_uk|striptags }}{% elif CURRENT_LANG == 'pl' and project.title_pl %}{{ project.title_pl|striptags }}{% else %}{{ project.title_en|striptags }}{% endif %} - {% trans 'Project Image' %}" 
               class="main-project-image" 
               loading="lazy"
               itemprop="url">
          <meta itemprop="width" content="1200">
          <meta itemprop="height" content="800">
          <div class="image-overlay-gradient"></div>
        </div>
      </div>
    </section>
  {% endif %}

  <section class="project-main-content" aria-labelledby="project-content">
    <div class="container">
      <div class="content-grid">
        
        <div class="main-content-column">
          
          {% include 'includes/project_content_block.html' with icon="üí°" title=_("Client Request") content_en=project.client_request_en content_uk=project.client_request_uk content_pl=project.client_request_pl extended_content_en=project.client_request_extended_en extended_content_uk=project.client_request_extended_uk extended_content_pl=project.client_request_extended_pl %}

          {% include 'includes/project_content_block.html' with icon="‚öôÔ∏è" title=_("Implementation") content_en=project.implementation_en content_uk=project.implementation_uk content_pl=project.implementation_pl extended_content_en=project.implementation_extended_en extended_content_uk=project.implementation_extended_uk extended_content_pl=project.implementation_extended_pl %}

          {% if project.challenges_and_solutions_uk or project.challenges_and_solutions_en %}
            {% include 'includes/project_content_block.html' with icon="üß©" title=_("Challenges & Solutions") content_en=project.challenges_and_solutions_en content_uk=project.challenges_and_solutions_uk content_pl=project.challenges_and_solutions_pl %}
          {% endif %}

          {% include 'includes/project_content_block.html' with icon="üìà" title=_("Results & Impact") content_en=project.results_en content_uk=project.results_uk content_pl=project.results_pl extended_content_en=project.results_extended_en extended_content_uk=project.results_extended_uk extended_content_pl=project.results_extended_pl %}

          {% if project.lessons_learned_uk or project.lessons_learned_en %}
            {% include 'includes/project_content_block.html' with icon="üéì" title=_("Lessons Learned") content_en=project.lessons_learned_en content_uk=project.lessons_learned_uk content_pl=project.lessons_learned_pl %}
          {% endif %}

        </div>

        {% include 'includes/project_sidebar.html' with project=project %}
        
      </div>
    </div>
  </section>

  {% if project.gallery_image_1 or project.gallery_image_2 or project.gallery_image_3 %}
    <section class="project-gallery-section" aria-labelledby="gallery-heading">
      <div class="container">
        <header class="gallery-header">
          <h2 id="gallery-heading">{% trans "Project Gallery" %}</h2>
          <p>{% trans "Visual overview of the implementation process" %}</p>
        </header>
        
        <div class="gallery-grid" role="list">
          {% if project.gallery_image_1 %}
            <div class="gallery-item" onclick="openLightbox('{{ project.gallery_image_1.url }}')" role="listitem" tabindex="0" aria-label="{% trans 'Open gallery image' %} 1">
              <img src="{{ project.gallery_image_1.url }}" alt="{% if CURRENT_LANG == 'uk' and project.title_uk %}{{ project.title_uk|striptags }}{% elif CURRENT_LANG == 'pl' and project.title_pl %}{{ project.title_pl|striptags }}{% else %}{{ project.title_en|striptags }}{% endif %} - {% trans 'Gallery Image' %} 1" loading="lazy" itemprop="image">
              <div class="gallery-overlay">
                <i data-lucide="zoom-in" aria-hidden="true"></i>
              </div>
            </div>
          {% endif %}
          {% if project.gallery_image_2 %}
            <div class="gallery-item" onclick="openLightbox('{{ project.gallery_image_2.url }}')" role="listitem" tabindex="0" aria-label="{% trans 'Open gallery image' %} 2">
              <img src="{{ project.gallery_image_2.url }}" alt="{% if CURRENT_LANG == 'uk' and project.title_uk %}{{ project.title_uk|striptags }}{% elif CURRENT_LANG == 'pl' and project.title_pl %}{{ project.title_pl|striptags }}{% else %}{{ project.title_en|striptags }}{% endif %} - {% trans 'Gallery Image' %} 2" loading="lazy" itemprop="image">
              <div class="gallery-overlay">
                <i data-lucide="zoom-in" aria-hidden="true"></i>
              </div>
            </div>
          {% endif %}
          {% if project.gallery_image_3 %}
            <div class="gallery-item" onclick="openLightbox('{{ project.gallery_image_3.url }}')" role="listitem" tabindex="0" aria-label="{% trans 'Open gallery image' %} 3">
              <img src="{{ project.gallery_image_3.url }}" alt="{% if CURRENT_LANG == 'uk' and project.title_uk %}{{ project.title_uk|striptags }}{% elif CURRENT_LANG == 'pl' and project.title_pl %}{{ project.title_pl|striptags }}{% else %}{{ project.title_en|striptags }}{% endif %} - {% trans 'Gallery Image' %} 3" loading="lazy" itemprop="image">
              <div class="gallery-overlay">
                <i data-lucide="zoom-in" aria-hidden="true"></i>
              </div>
            </div>
          {% endif %}
        </div>
      </div>
    </section>
  {% endif %}

  {% if project.video_url or project.video_file %}
    <section class="project-video-section">
      <div class="container">
        <header class="video-header">
          <h2>{% trans "Video Walkthrough" %}</h2>
        </header>
        
        <div class="video-container glass">
          {% if project.video_url %}
            <iframe src="{{ project.video_url }}" frameborder="0" allowfullscreen></iframe>
          {% elif project.video_file %}
            <video controls>
              <source src="{{ project.video_file.url }}" type="video/mp4">
            </video>
          {% endif %}
        </div>
      </div>
    </section>
  {% endif %}

  {% include 'includes/social_share.html' %}

  <section class="project-contact-cta">
    <div class="container">
      <div class="contact-cta-card glass card">
        <div class="cta-content">
          <h2>{% trans "Ready to Start Your Project?" %}</h2>
          <p class="cta-description">
            {% trans "Let's discuss how we can bring your ideas to life with custom AI and automation solutions." %}
          </p>
          <div class="cta-actions">
            <button class="btn-primary" 
                    data-project-title="{% if CURRENT_LANG == 'uk' and project.title_uk %}{{ project.title_uk|escapejs }}{% elif CURRENT_LANG == 'pl' and project.title_pl %}{{ project.title_pl|escapejs }}{% else %}{{ project.title_en|escapejs }}{% endif %}"
                    onclick="window.ctaModal && window.ctaModal.show('project_detail', '–ü—Ä–æ—î–∫—Ç: ' + this.dataset.projectTitle);">
              <i data-lucide="message-circle"></i>
              {% trans "Start Free Consultation" %}
            </button>
            <a href="/{% if CURRENT_LANG != 'en' %}{{ CURRENT_LANG }}/{% endif %}services/{{ project.category.slug }}/" class="btn-secondary">
              <i data-lucide="grid-3x3"></i>
              {% trans "Open Service" %}
            </a>
          </div>
        </div>
      </div>
    </div>
  </section>

</article>

<div id="lightbox" class="lightbox" onclick="closeLightbox()">
  <div class="lightbox-content">
    <img id="lightbox-image" src="" alt="">
    <button class="lightbox-close" onclick="closeLightbox()">
      <i data-lucide="x"></i>
    </button>
  </div>
</div>

{% endblock %}

{% block extra_scripts %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "CreativeWork",
  "name": "{% if CURRENT_LANG == 'uk' and project.title_uk %}{{ project.title_uk|escapejs }}{% elif CURRENT_LANG == 'pl' and project.title_pl %}{{ project.title_pl|escapejs }}{% else %}{{ project.title_en|escapejs }}{% endif %}",
  "description": "{% if CURRENT_LANG == 'uk' and project.short_description_uk %}{{ project.short_description_uk|striptags|escapejs }}{% elif CURRENT_LANG == 'pl' and project.short_description_pl %}{{ project.short_description_pl|striptags|escapejs }}{% else %}{{ project.short_description_en|striptags|escapejs }}{% endif %}",
  "url": "https://lazysoft.pl/{% if CURRENT_LANG != 'en' %}{{ CURRENT_LANG }}/{% endif %}projects/{{ project.slug }}/",
  "inLanguage": "{{ CURRENT_LANG }}",
  "dateCreated": "{{ project.project_date|date:'c' }}",
  "dateModified": "{{ project.date_updated|date:'c' }}",
  {% if project.featured_image %}"image": [
    "https://lazysoft.pl{{ project.featured_image.url }}"{% if project.gallery_image_1 %},
    "https://lazysoft.pl{{ project.gallery_image_1.url }}"{% endif %}{% if project.gallery_image_2 %},
    "https://lazysoft.pl{{ project.gallery_image_2.url }}"{% endif %}
  ],{% endif %}
  {% if project.technologies_used %}"keywords": "{{ project.technologies_used }}",{% endif %}
  {% if project.project_url %}"workExample": "{{ project.project_url }}",{% endif %}
  "creator": {
    "@type": "Organization",
    "name": "Lazysoft",
    "url": "https://lazysoft.pl",
    "logo": "https://lazysoft.pl/static/images/logo.svg"
  }{% if project.category %},
  "about": {
    "@type": "Thing",
    "name": "{% if CURRENT_LANG == 'uk' and project.category.title_uk %}{{ project.category.title_uk|escapejs }}{% elif CURRENT_LANG == 'pl' and project.category.title_pl %}{{ project.category.title_pl|escapejs }}{% else %}{{ project.category.title_en|escapejs }}{% endif %}"
  }{% endif %}
}
</script>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "{% trans 'Home' %}",
      "item": "https://lazysoft.pl/{% if CURRENT_LANG != 'en' %}{{ CURRENT_LANG }}/{% endif %}"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "{% trans 'Projects' %}",
        "item": "https://lazysoft.pl/{% if CURRENT_LANG != 'en' %}{{ CURRENT_LANG }}/{% endif %}projects/"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "{% if CURRENT_LANG == 'uk' and project.title_uk %}{{ project.title_uk|striptags|escapejs }}{% elif CURRENT_LANG == 'pl' and project.title_pl %}{{ project.title_pl|striptags|escapejs }}{% else %}{{ project.title_en|striptags|escapejs }}{% endif %}",
      "item": "https://lazysoft.pl/{% if CURRENT_LANG != 'en' %}{{ CURRENT_LANG }}/{% endif %}projects/{{ project.slug }}/"
    }
  ]
}
</script>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {
      "@type": "Question",
      "name": "{% trans 'What was the client request for' %} {% if CURRENT_LANG == 'uk' and project.title_uk %}{{ project.title_uk|striptags|escapejs }}{% elif CURRENT_LANG == 'pl' and project.title_pl %}{{ project.title_pl|striptags|escapejs }}{% else %}{{ project.title_en|striptags|escapejs }}{% endif %}?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "{% if CURRENT_LANG == 'uk' and project.client_request_uk %}{{ project.client_request_uk|striptags|escapejs|truncatewords:50 }}{% elif CURRENT_LANG == 'pl' and project.client_request_pl %}{{ project.client_request_pl|striptags|escapejs|truncatewords:50 }}{% else %}{{ project.client_request_en|striptags|escapejs|truncatewords:50 }}{% endif %}"
      }
    },
    {
      "@type": "Question",
      "name": "{% trans 'What technologies were used' %}?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "{{ project.technologies_used|default:'AI, Automation, Custom Development' }}"
      }
    }{% if project.results_uk or project.results_en %},
    {
      "@type": "Question",
      "name": "{% trans 'What were the results' %}?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "{% if CURRENT_LANG == 'uk' and project.results_uk %}{{ project.results_uk|striptags|escapejs|truncatewords:50 }}{% elif CURRENT_LANG == 'pl' and project.results_pl %}{{ project.results_pl|striptags|escapejs|truncatewords:50 }}{% else %}{{ project.results_en|striptags|escapejs|truncatewords:50 }}{% endif %}"
      }
    }{% endif %}
  ]
}
</script>

<script>
function openLightbox(imageSrc) {
  const lightbox = document.getElementById('lightbox');
  const lightboxImage = document.getElementById('lightbox-image');
  lightboxImage.src = imageSrc;
  lightbox.style.display = 'flex';
  document.body.style.overflow = 'hidden';
}

function closeLightbox() {
  const lightbox = document.getElementById('lightbox');
  lightbox.style.display = 'none';
  document.body.style.overflow = 'auto';
}

function scrollToContact(projectTitle) {
  window.location.href = `/${document.body.getAttribute('data-current-lang') || 'en'}/#contact`;
  
  setTimeout(() => {
    const messageField = document.querySelector('textarea[name="message"], input[name="message"]');
    if (messageField && projectTitle) {
      const message = `{% trans "Hi! I'm interested in the project" %} "${projectTitle}". {% trans "I'd like to discuss creating something similar for my business." %}`;
      messageField.value = message;
    }
  }, 1000);
}

document.addEventListener('DOMContentLoaded', function() {
  const expandTriggers = document.querySelectorAll('.expand-trigger');
  expandTriggers.forEach(trigger => {
    trigger.addEventListener('click', function() {
      const chevron = this.querySelector('[data-lucide="chevron-down"]');
      if (chevron) {
        setTimeout(() => {
          const isOpen = this.parentElement.hasAttribute('open');
          chevron.style.transform = isOpen ? 'rotate(180deg)' : 'rotate(0deg)';
        }, 10);
      }
    });
  });
  
  if (typeof lucide !== 'undefined') {
    lucide.createIcons();
  }
});

document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') {
    closeLightbox();
  }
});
</script>
{% endblock %}