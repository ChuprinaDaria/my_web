{% load static i18n %}
{% get_current_language as CURRENT_LANG %}

<!-- 📊 Project Sidebar -->
<aside class="project-sidebar">
  
  <!-- Project Tags -->
  {% if project_tags %}
    <div class="sidebar-section glass card">
      <h3 class="sidebar-title">
        <i data-lucide="tags"></i>
        {% trans "Project Tags" %}
      </h3>
      <div class="project-tags">
        {% for tag in project_tags %}
          <a href="{% url 'projects_by_tag' tag.slug %}" class="tag-chip" data-color="{{ tag.color }}">
            {% if tag.icon %}<span class="tag-icon">{{ tag.icon }}</span>{% endif %}
            <span class="tag-name">{{ tag.name }}</span>
          </a>
        {% endfor %}
      </div>
    </div>
  {% endif %}

  <!-- Technologies -->
  {% if project.technologies_used %}
    <div class="sidebar-section glass card">
      <h3 class="sidebar-title">
        <i data-lucide="code"></i>
        {% trans "Technologies" %}
      </h3>
      <div class="tech-stack">
        {% for tech in project.get_technologies_list %}
          <span class="tech-chip">{{ tech }}</span>
        {% endfor %}
      </div>
    </div>
  {% endif %}

  <!-- Project Info -->
  <div class="sidebar-section glass card">
    <h3 class="sidebar-title">
      <i data-lucide="info"></i>
      {% trans "Project Info" %}
    </h3>
    <div class="project-info-list">
      <div class="info-item">
        <div class="info-label">{% trans "Status" %}</div>
        <div class="info-value">
          {% if project.project_status == 'completed' %}✅{% elif project.project_status == 'in_progress' %}🔄{% else %}📋{% endif %}
          {{ project.get_project_status_display }}
        </div>
      </div>
      <div class="info-item">
        <div class="info-label">{% trans "Completed" %}</div>
        <div class="info-value">{{ project.project_date|date:"F Y" }}</div>
      </div>
      {% if project.development_duration_weeks %}
        <div class="info-item">
          <div class="info-label">{% trans "Duration" %}</div>
          <div class="info-value">
            {{ project.development_duration_weeks }} 
            {% if CURRENT_LANG == 'uk' %}тижнів
            {% elif CURRENT_LANG == 'pl' %}tygodni  
            {% else %}weeks{% endif %}
          </div>
        </div>
      {% endif %}
      {% if project.client_time_saved_hours %}
        <div class="info-item">
          <div class="info-label">{% trans "Time Saved" %}</div>
          <div class="info-value">{{ project.client_time_saved_hours }}h/{% trans "week" %}</div>
        </div>
      {% endif %}
    </div>
  </div>

  <!-- Client Review -->
  {% if project.review and project.review.is_active %}
    <div class="sidebar-section glass card">
      <h3 class="sidebar-title">
        <i data-lucide="message-square"></i>
        {% trans "Client Review" %}
      </h3>
      <div class="client-review">
        {% if project.review.client_avatar %}
          <div class="client-avatar" style="width:56px;height:56px;border-radius:50%;overflow:hidden;margin-bottom:12px;">
            <img src="{{ project.review.client_avatar.url }}" alt="{{ project.review.client_name }}" style="width:100%;height:100%;object-fit:cover;"/>
          </div>
        {% endif %}
        <div class="client-name" style="font-weight:700;">{{ project.review.client_name }}</div>
        {% if project.review.client_position or project.review.client_company %}
          <div class="client-position" style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom:8px;">
            {{ project.review.client_position }}{% if project.review.client_company %} · {{ project.review.client_company }}{% endif %}
          </div>
        {% endif %}
        <div class="client-rating" style="margin: 6px 0 10px 0;">
          {% for _ in '12345' %}
            {% if forloop.counter <= project.review.rating %}⭐{% else %}☆{% endif %}
          {% endfor %}
        </div>
        <div class="client-text" style="line-height:1.6;">
          {% if CURRENT_LANG == 'uk' and project.review.review_text_uk %}{{ project.review.review_text_uk|safe }}
          {% elif CURRENT_LANG == 'pl' and project.review.review_text_pl %}{{ project.review.review_text_pl|safe }}
          {% else %}{{ project.review.review_text_en|safe }}{% endif %}
        </div>
      </div>
    </div>
  {% endif %}

  <!-- Related Articles -->
  {% if related_articles %}
    <div class="sidebar-section glass card">
      <h3 class="sidebar-title">
        <i data-lucide="newspaper"></i>
        {% trans "Related News" %}
      </h3>
      <div class="related-content-list">
        {% for article in related_articles %}
          <a href="{{ article.url }}" class="related-item" target="_blank">
            <div class="related-content">
              <h4 class="related-title">{{ article.title|truncatewords:8 }}</h4>
              <div class="related-meta">
                {% if article.category %}<span class="related-category">{{ article.category }}</span>{% endif %}
                <time class="related-date">{{ article.published_at|date:"j.m" }}</time>
              </div>
            </div>
            {% if article.image %}
              <div class="related-image">
                <img src="{{ article.image }}" alt="{{ article.title }}" loading="lazy">
              </div>
            {% endif %}
          </a>
        {% endfor %}
      </div>
    </div>
  {% endif %}

  <!-- Related Services -->
  {% if related_services %}
    <div class="sidebar-section glass card">
      <h3 class="sidebar-title">
        <i data-lucide="grid-3x3"></i>
        {% trans "Related Services" %}
      </h3>
      <div class="related-services-list">
        {% for service in related_services %}
          <a href="{{ service.url }}" class="service-item">
            <div class="service-icon">
              {% if service.icon %}<img src="{{ service.icon.url }}" alt="{{ service.title }}">{% else %}<span>🔧</span>{% endif %}
            </div>
            <div class="service-info">
              <span class="service-name">{{ service.title }}</span>
              <small class="service-description">{{ service.short|truncatewords:8 }}</small>
            </div>
          </a>
        {% endfor %}
      </div>
    </div>
  {% endif %}

  <!-- CTA Sidebar -->
  <div class="sidebar-section glass card cta-sidebar">
    <h3 class="sidebar-title">
      <i data-lucide="sparkles"></i>
      {% trans "Want Similar?" %}
    </h3>
    <p class="cta-description">
      {% trans "Let's discuss how we can create something similar for your business." %}
    </p>
    <button class="sidebar-cta-button" 
            data-project-title="{% if CURRENT_LANG == 'uk' and project.title_uk %}{{ project.title_uk|escapejs }}{% elif CURRENT_LANG == 'pl' and project.title_pl %}{{ project.title_pl|escapejs }}{% else %}{{ project.title_en|escapejs }}{% endif %}"
            onclick="scrollToContact(this.dataset.projectTitle);">
      <i data-lucide="arrow-right"></i>
      {% trans "Start Discussion" %}
    </button>
  </div>

</aside>

<script>
// Apply dynamic colors to tag chips
document.addEventListener('DOMContentLoaded', function() {
  const tagChips = document.querySelectorAll('.tag-chip[data-color]');
  tagChips.forEach(chip => {
    const color = chip.getAttribute('data-color');
    if (color) {
      chip.style.setProperty('--tag-color', color);
      chip.style.backgroundColor = color + '20';
      chip.style.color = color;
      chip.style.borderColor = color + '40';
    }
  });
});
</script>