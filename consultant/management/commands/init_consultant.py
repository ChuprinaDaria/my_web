from django.core.management.base import BaseCommand
from consultant.models import ConsultantProfile, KnowledgeBase


class Command(BaseCommand):
    help = '–°—Ç–≤–æ—Ä—é—î –±–∞–∑–æ–≤–∏–π –ø—Ä–æ—Ñ—ñ–ª—å –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞ —Ç–∞ –ø–æ—á–∞—Ç–∫–æ–≤—ñ –¥–∞–Ω—ñ'

    def handle(self, *args, **options):
        # –°—Ç–≤–æ—Ä—é—î–º–æ –ø—Ä–æ—Ñ—ñ–ª—å –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞
        consultant, created = ConsultantProfile.objects.get_or_create(
            name="RAG –ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç",
            defaults={
                'description': '–®—Ç—É—á–Ω–∏–π —ñ–Ω—Ç–µ–ª–µ–∫—Ç –¥–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ–π —Ç–∞ –¥–æ–ø–æ–º–æ–≥–∏',
                'avatar': 'ü´ß',
                'is_active': True,
                'max_tokens': 4000,
                'temperature': 0.7,
                'system_prompt': '–¢–∏ RAG –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç - —à—Ç—É—á–Ω–∏–π —ñ–Ω—Ç–µ–ª–µ–∫—Ç, —è–∫–∏–π –¥–æ–ø–æ–º–∞–≥–∞—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º –∑ —Ä—ñ–∑–Ω–∏–º–∏ –ø–∏—Ç–∞–Ω–Ω—è–º–∏. –í—ñ–¥–ø–æ–≤—ñ–¥–∞–π –∫–æ—Ä–∏—Å–Ω–∏–º–∏, —Ç–æ—á–Ω–∏–º–∏ —Ç–∞ –¥—Ä—É–∂–µ–ª—é–±–Ω–∏–º–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—è–º–∏ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é.'
            }
        )
        
        if created:
            self.stdout.write(
                self.style.SUCCESS(f'‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ –ø—Ä–æ—Ñ—ñ–ª—å –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞: {consultant.name}')
            )
        else:
            self.stdout.write(
                self.style.WARNING(f'‚ö†Ô∏è –ü—Ä–æ—Ñ—ñ–ª—å –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞ –≤–∂–µ —ñ—Å–Ω—É—î: {consultant.name}')
            )

        # –°—Ç–≤–æ—Ä—é—î–º–æ –±–∞–∑–æ–≤—ñ –∑–Ω–∞–Ω–Ω—è
        knowledge_items = [
            {
                'title': '–©–æ —Ç–∞–∫–µ RAG?',
                'content': 'RAG (Retrieval-Augmented Generation) - —Ü–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—è, —è–∫–∞ –ø–æ—î–¥–Ω—É—î –≥–µ–Ω–µ—Ä–∞—Ç–∏–≤–Ω—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ —à—Ç—É—á–Ω–æ–≥–æ —ñ–Ω—Ç–µ–ª–µ–∫—Ç—É –∑ –¥–æ—Å—Ç—É–ø–æ–º –¥–æ –∞–∫—Ç—É–∞–ª—å–Ω–æ—ó –±–∞–∑–∏ –∑–Ω–∞–Ω—å. –¶–µ –¥–æ–∑–≤–æ–ª—è—î –Ω–∞–¥–∞–≤–∞—Ç–∏ —Ç–æ—á–Ω—ñ —Ç–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ.',
                'category': 'AI',
                'tags': 'RAG, AI, –º–∞—à–∏–Ω–Ω–µ –Ω–∞–≤—á–∞–Ω–Ω—è',
                'priority': 10
            },
            {
                'title': '–ü–æ—Å–ª—É–≥–∏ Lazysoft',
                'content': 'Lazysoft –Ω–∞–¥–∞—î –ø–æ—Å–ª—É–≥–∏ –∑ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—ó, —Ä–æ–∑—Ä–æ–±–∫–∏ –≤–µ–±-–¥–æ–¥–∞—Ç–∫—ñ–≤, —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –±–æ—Ç—ñ–≤ —Ç–∞ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó –∑—ñ —à—Ç—É—á–Ω–∏–º —ñ–Ω—Ç–µ–ª–µ–∫—Ç–æ–º. –ú–∏ —Å–ø–µ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ—Å—è –Ω–∞ —Å—É—á–∞—Å–Ω–∏—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—è—Ö —Ç–∞ —ñ–Ω–Ω–æ–≤–∞—Ü—ñ–π–Ω–∏—Ö —Ä—ñ—à–µ–Ω–Ω—è—Ö.',
                'category': '–ü–æ—Å–ª—É–≥–∏',
                'tags': '–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—è, –≤–µ–±-—Ä–æ–∑—Ä–æ–±–∫–∞, –±–æ—Ç–∏, AI',
                'priority': 9
            },
            {
                'title': '–Ø–∫ –∑–≤\'—è–∑–∞—Ç–∏—Å—è –∑ Lazysoft',
                'content': '–ó –Ω–∞–º–∏ –º–æ–∂–Ω–∞ –∑–≤\'—è–∑–∞—Ç–∏—Å—è —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç–∞–∫—Ç–Ω—É —Ñ–æ—Ä–º—É –Ω–∞ —Å–∞–π—Ç—ñ, email –∞–±–æ —Å–æ—Ü—ñ–∞–ª—å–Ω—ñ –º–µ—Ä–µ–∂—ñ. –ú–∏ –∑–∞–≤–∂–¥–∏ –≥–æ—Ç–æ–≤—ñ –æ–±–≥–æ–≤–æ—Ä–∏—Ç–∏ –≤–∞—à –ø—Ä–æ–µ–∫—Ç —Ç–∞ –∑–∞–ø—Ä–æ–ø–æ–Ω—É–≤–∞—Ç–∏ –Ω–∞–π–∫—Ä–∞—â–µ —Ä—ñ—à–µ–Ω–Ω—è.',
                'category': '–ö–æ–Ω—Ç–∞–∫—Ç–∏',
                'tags': '–∫–æ–Ω—Ç–∞–∫—Ç–∏, –ø—ñ–¥—Ç—Ä–∏–º–∫–∞, —Å–ø—ñ–≤–ø—Ä–∞—Ü—è',
                'priority': 8
            }
        ]

        created_count = 0
        for item in knowledge_items:
            knowledge, created = KnowledgeBase.objects.get_or_create(
                title=item['title'],
                defaults={
                    'content': item['content'],
                    'category': item['category'],
                    'tags': item['tags'],
                    'priority': item['priority'],
                    'is_active': True
                }
            )
            
            if created:
                created_count += 1
                self.stdout.write(
                    self.style.SUCCESS(f'‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ –∑–Ω–∞–Ω–Ω—è: {knowledge.title}')
                )

        self.stdout.write(
            self.style.SUCCESS(f'üéâ –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –°—Ç–≤–æ—Ä–µ–Ω–æ {created_count} –Ω–æ–≤–∏—Ö –∑–∞–ø–∏—Å—ñ–≤ –∑–Ω–∞–Ω—å.')
        )
