{% load i18n %}
<!DOCTYPE html>
<html lang="{{ language|default:'uk' }}">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% if language == 'uk' %}Комерційна пропозиція{% elif language == 'pl' %}Oferta handlowa{% else %}Commercial Proposal{% endif %}</title>
  <style>
    body { font-family: Arial, Helvetica, sans-serif; color: #111; margin: 0; padding: 0; }
    .wrapper { max-width: 800px; margin: 0 auto; padding: 24px; }
    .header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 24px; }
    .brand-block { display: flex; align-items: center; gap: 12px; }
    .brand-logo { height: 42px; }
    h1 { font-size: 22px; margin: 8px 0 4px; }
    h2 { font-size: 18px; margin: 24px 0 8px; }
    p { line-height: 1.5; margin: 6px 0; }
    .muted { color: #666; font-size: 13px; }
    .meta { background: #f7f7f7; border-radius: 8px; padding: 12px 16px; margin: 16px 0; }
    table { width: 100%; border-collapse: collapse; margin: 10px 0 20px; }
    th, td { border: 1px solid #e5e5e5; padding: 10px 12px; text-align: left; vertical-align: top; }
    th { background: #fafafa; font-weight: 600; }
    .price { white-space: nowrap; font-weight: 600; }
    .cta { margin: 28px 0; padding: 16px; background: #f4fbf0; border: 1px solid #d6f0c2; border-radius: 8px; }
    .cta a { display: inline-block; background: #198754; color: #fff !important; text-decoration: none; padding: 10px 16px; border-radius: 6px; }
    .footer { margin-top: 32px; font-size: 12px; color: #666; }
    ul { margin: 6px 0 0 18px; padding: 0; }
  </style>
</head>
<body>
<div class="wrapper">
  <div class="header">
    <div class="brand-block">
      {% if brand_logo_url %}<img src="{{ brand_logo_url }}" alt="Logo" class="brand-logo" />{% endif %}
      <div>
        <div style="font-weight: 700">{{ brand.company_name|default:'LAZYSOFT' }}</div>
        <div class="muted">{{ brand.website|default:'https://lazysoft.pl' }}</div>
      </div>
    </div>
    <div class="muted">{{ issued_at|date:'Y-m-d H:i' }}</div>
  </div>

  <h1>
    {% if language == 'uk' %}Комерційна пропозиція{% elif language == 'pl' %}Oferta handlowa{% else %}Commercial Proposal{% endif %}
  </h1>

  <div class="meta">
    <p><strong>{% if language == 'uk' %}Клієнт{% elif language == 'pl' %}Klient{% else %}Client{% endif %}:</strong> {{ name }}</p>
    <p><strong>Email:</strong> {{ email }}</p>
    {% if company %}<p><strong>{% if language == 'uk' %}Компанія{% elif language == 'pl' %}Firma{% else %}Company{% endif %}:</strong> {{ company }}</p>{% endif %}
    {% if notes %}<p><strong>{% if language == 'uk' %}Запит{% elif language == 'pl' %}Zapytanie{% else %}Request{% endif %}:</strong> {{ notes }}</p>{% endif %}
  </div>

  <h2>{% if language == 'uk' %}Орієнтовні пакети та ціни{% elif language == 'pl' %}Proponowane pakiety i ceny{% else %}Suggested packages and pricing{% endif %}</h2>
  <table role="table" aria-label="Pricing table">
    <thead>
      <tr>
        <th scope="col">{% if language == 'uk' %}Послуга{% elif language == 'pl' %}Usługa{% else %}Service{% endif %}</th>
        <th scope="col">{% if language == 'uk' %}Пакет{% elif language == 'pl' %}Pakiet{% else %}Package{% endif %}</th>
        <th scope="col" class="price">{% if language == 'uk' %}Ціна (USD){% elif language == 'pl' %}Cena (USD){% else %}Price (USD){% endif %}</th>
        <th scope="col">{% if language == 'uk' %}Що входить{% elif language == 'pl' %}Zakres{% else %}Includes{% endif %}</th>
      </tr>
    </thead>
    <tbody>
      {% for it in items %}
      <tr>
        <td>{{ it.title }}</td>
        <td>{{ it.pkg }}</td>
        <td class="price">{{ it.price }} {{ it.currency }}</td>
        <td>
          {% if it.assumptions %}
            <ul>
              {% for f in it.assumptions.split(';') %}
                {% if f.strip %}<li>{{ f|trim }}</li>{% endif %}
              {% endfor %}
            </ul>
          {% else %}
            —
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  {% if calendly_url %}
  <div class="cta">
    <p style="margin-top: 0">
      {% if language == 'uk' %}
        Запросіть безкоштовну 30-хв консультацію для детального аналізу вашого запиту.
      {% elif language == 'pl' %}
        Umów bezpłatną 30-min konsultację w celu szczegółowej analizy Twojego zapytania.
      {% else %}
        Book a free 30-min consultation for a detailed analysis of your request.
      {% endif %}
    </p>
    <a href="{{ calendly_url }}" target="_blank" rel="noopener">
      {% if language == 'uk' %}Записатися на консультацію{% elif language == 'pl' %}Umów konsultację{% else %}Schedule consultation{% endif %}
    </a>
  </div>
  {% endif %}

  <p class="muted">
    {% if language == 'uk' %}
      Примітка: наведені ціни є орієнтовними і можуть змінюватися залежно від деталей проєкту.
    {% elif language == 'pl' %}
      Uwaga: podane ceny są orientacyjne i mogą ulec zmianie w zależności od szczegółów projektu.
    {% else %}
      Note: Prices are indicative and may vary depending on project details.
    {% endif %}
  </p>

  <div class="footer">
    <p>
      {{ brand.company_name|default:'LAZYSOFT' }} — {{ brand.address_line1|default:'' }} {{ brand.city|default:'' }} {{ brand.postal_code|default:'' }}
      {% if brand.phone %} • {{ brand.phone }}{% endif %}
      {% if brand.email %} • {{ brand.email }}{% endif %}
    </p>
    <p class="muted">© {{ issued_at|date:'Y' }} {{ brand.company_name|default:'LAZYSOFT' }}</p>
  </div>
</div>
</body>
</html>
